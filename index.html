<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    <title>QUICK SHOP | Marketplace & Social Platform</title>
    <meta name="description" content="Post products, jobs, and social updates. Earn 50% on referrals. Free posts for subscribed users. Boost your posts for visibility.">
    <meta name="keywords" content="quick shop, marketplace, social media, jobs, kenya, earn money, referrals">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800;900&family=Montserrat:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon.png">    
    
    <style>
        /* ============================================
           GLOBAL STYLES & VARIABLES - DARK THEME
        ============================================ */
        :root {
            --primary: #1E3A8A; /* Dark Blue */
            --primary-dark: #0F2A6B;
            --primary-light: #3B82F6;
            --secondary: #D4AF37; /* Gold */
            --secondary-dark: #B8860B;
            --accent: #8B4513; /* Brown */
            --accent-dark: #5D2906;
            --success: #10B981;
            --warning: #F59E0B;
            --danger: #EF4444;
            --info: #3B82F6;
            
            --dark: #0F172A;
            --dark-gray: #1E293B;
            --gray: #475569;
            --light-gray: #94A3B8;
            --lighter-gray: #CBD5E1;
            --lightest-gray: #F1F5F9;
            --white: #FFFFFF;
            
            --shadow-sm: 0 2px 4px rgba(0,0,0,0.3);
            --shadow: 0 4px 8px rgba(0,0,0,0.4);
            --shadow-md: 0 6px 12px rgba(0,0,0,0.5);
            --shadow-lg: 0 10px 25px rgba(0,0,0,0.6);
            --shadow-xl: 0 20px 40px rgba(0,0,0,0.7);
            
            --radius-sm: 6px;
            --radius: 10px;
            --radius-md: 14px;
            --radius-lg: 18px;
            --radius-xl: 24px;
            --radius-full: 9999px;
            
            --transition-fast: all 0.2s ease;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: all 0.5s ease;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html {
            scroll-behavior: smooth;
            font-size: 16px;
        }
        
        body {
            font-family: 'Poppins', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            line-height: 1.6;
            color: var(--lighter-gray);
            background-color: var(--dark);
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Montserrat', sans-serif;
            font-weight: 700;
            color: var(--white);
        }
        
        h1 { font-size: clamp(2rem, 5vw, 3.5rem); }
        h2 { font-size: clamp(1.75rem, 4vw, 2.5rem); }
        h3 { font-size: clamp(1.5rem, 3.5vw, 2rem); }
        h4 { font-size: clamp(1.25rem, 3vw, 1.75rem); }
        h5 { font-size: clamp(1.125rem, 2.5vw, 1.5rem); }
        h6 { font-size: clamp(1rem, 2vw, 1.25rem); }
        
        /* ============================================
           SPLASH SCREEN
        ============================================ */
        .splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--primary) 0%, var(--dark) 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity 0.5s ease, visibility 0.5s ease;
        }
        
        .splash-screen.hidden {
            opacity: 0;
            visibility: hidden;
        }
        
        .splash-logo {
            width: 120px;
            height: 120px;
            background: var(--secondary);
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 2rem;
            animation: pulse 2s infinite;
            box-shadow: 0 0 30px rgba(212, 175, 55, 0.3);
        }
        
        .splash-logo-icon {
            font-size: 3.5rem;
            font-weight: 900;
            background: linear-gradient(135deg, var(--dark), var(--primary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .splash-text {
            color: var(--secondary);
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 1rem;
            text-shadow: 0 2px 10px rgba(0,0,0,0.5);
        }
        
        .splash-loader {
            width: 200px;
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-full);
            overflow: hidden;
            margin-top: 2rem;
        }
        
        .splash-progress {
            width: 0%;
            height: 100%;
            background: linear-gradient(90deg, var(--secondary), var(--accent));
            transition: width 0.3s ease;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); box-shadow: 0 0 30px rgba(212, 175, 55, 0.3); }
            50% { transform: scale(1.05); box-shadow: 0 0 40px rgba(212, 175, 55, 0.5); }
        }
        
        /* ============================================
           CONTAINER
        ============================================ */
        .container {
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 1rem;
        }
        
        /* ============================================
           HEADER & NAVIGATION
        ============================================ */
        .header {
            background: var(--dark-gray);
            box-shadow: var(--shadow);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            height: 70px;
            border-bottom: 2px solid var(--primary);
        }
        
        .nav-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 100%;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            text-decoration: none;
            font-family: 'Montserrat', sans-serif;
        }
        
        .logo-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--dark);
            font-size: 1.5rem;
            font-weight: 900;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        
        .logo-text {
            font-size: 1.75rem;
            font-weight: 900;
            color: var(--white);
            display: flex;
            flex-direction: column;
            line-height: 1.2;
        }
        
        .logo-text span {
            color: var(--secondary);
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }
        
        .logo-tagline {
            font-size: 0.75rem;
            color: var(--light-gray);
            font-weight: 400;
            font-family: 'Poppins', sans-serif;
        }
        
        .mobile-menu-btn {
            display: none;
            flex-direction: column;
            gap: 5px;
            background: none;
            border: none;
            width: 40px;
            height: 40px;
            padding: 8px;
            cursor: pointer;
            z-index: 1001;
        }
        
        .mobile-menu-btn span {
            display: block;
            width: 100%;
            height: 3px;
            background: var(--secondary);
            border-radius: 2px;
            transition: var(--transition);
        }
        
        .nav-menu {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }
        
        .nav-links {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .nav-link {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.25rem;
            color: var(--light-gray);
            text-decoration: none;
            border-radius: var(--radius);
            transition: var(--transition-fast);
            font-weight: 500;
            white-space: nowrap;
        }
        
        .nav-link:hover, .nav-link.active {
            background: rgba(59, 130, 246, 0.15);
            color: var(--primary-light);
            border: 1px solid rgba(59, 130, 246, 0.3);
        }
        
        .nav-link i {
            font-size: 1.1rem;
        }
        
        .user-section {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .user-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--dark);
            font-weight: 600;
            cursor: pointer;
            border: 2px solid transparent;
            transition: var(--transition-fast);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .user-avatar:hover {
            border-color: var(--secondary);
            transform: scale(1.05);
        }
        
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: var(--radius);
            font-weight: 600;
            font-size: 0.95rem;
            cursor: pointer;
            transition: var(--transition-fast);
            border: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            text-align: center;
            white-space: nowrap;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: var(--white);
            border: 1px solid rgba(59, 130, 246, 0.3);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
            background: linear-gradient(135deg, var(--primary-light), var(--primary));
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, var(--secondary), var(--secondary-dark));
            color: var(--dark);
            border: 1px solid rgba(212, 175, 55, 0.3);
        }
        
        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
            background: linear-gradient(135deg, var(--secondary), #FFD700);
        }
        
        .btn-accent {
            background: linear-gradient(135deg, var(--accent), var(--accent-dark));
            color: var(--white);
            border: 1px solid rgba(139, 69, 19, 0.3);
        }
        
        .btn-outline {
            background: transparent;
            border: 2px solid var(--gray);
            color: var(--light-gray);
        }
        
        .btn-outline:hover {
            border-color: var(--primary-light);
            color: var(--primary-light);
            background: rgba(59, 130, 246, 0.1);
        }
        
        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
        }
        
        .btn-lg {
            padding: 1rem 2rem;
            font-size: 1.1rem;
        }
        
        /* ============================================
           MEDIA UPLOAD STYLES
        ============================================ */
        .media-preview-container {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin-bottom: 1rem;
        }
        
        .media-preview {
            position: relative;
            width: 100px;
            height: 100px;
            border-radius: var(--radius);
            overflow: hidden;
            border: 2px solid var(--gray);
            background: var(--dark-gray);
        }
        
        .media-preview img, .media-preview video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .media-preview .remove-media {
            position: absolute;
            top: 5px;
            right: 5px;
            width: 24px;
            height: 24px;
            background: var(--danger);
            color: white;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            font-size: 0.75rem;
        }
        
        .upload-area {
            border: 2px dashed var(--gray);
            border-radius: var(--radius);
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            background: var(--dark-gray);
            margin-bottom: 1rem;
        }
        
        .upload-area:hover {
            border-color: var(--primary-light);
            background: rgba(59, 130, 246, 0.1);
        }
        
        .upload-area i {
            font-size: 2.5rem;
            color: var(--primary-light);
            margin-bottom: 1rem;
        }
        
        .media-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .media-gallery-item {
            width: 100%;
            height: 150px;
            border-radius: var(--radius);
            overflow: hidden;
            position: relative;
            background: var(--dark-gray);
        }
        
        .media-gallery-item img, .media-gallery-item video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        /* ============================================
           CHATBOT STYLES
        ============================================ */
        .chatbot-toggle {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--secondary);
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: var(--shadow-lg);
            z-index: 1000;
            transition: var(--transition);
            border: 2px solid var(--secondary);
        }
        
        .chatbot-toggle:hover {
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(212, 175, 55, 0.3);
        }
        
        .chatbot-container {
            position: fixed;
            bottom: 100px;
            right: 30px;
            width: 350px;
            height: 500px;
            background: var(--dark-gray);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-xl);
            z-index: 1001;
            display: none;
            flex-direction: column;
            overflow: hidden;
            border: 1px solid var(--primary);
        }
        
        .chatbot-container.active {
            display: flex;
            animation: slideUp 0.3s ease;
        }
        
        .chatbot-header {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: var(--secondary);
            padding: 1rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid var(--secondary);
        }
        
        .chatbot-close {
            background: none;
            border: none;
            color: var(--secondary);
            font-size: 1.2rem;
            cursor: pointer;
        }
        
        .chatbot-messages {
            flex: 1;
            padding: 1.5rem;
            overflow-y: auto;
            background: var(--dark);
        }
        
        .chat-message {
            margin-bottom: 1rem;
            max-width: 80%;
        }
        
        .chat-message.bot {
            align-self: flex-start;
        }
        
        .chat-message.user {
            align-self: flex-end;
            margin-left: auto;
        }
        
        .message-bubble {
            padding: 0.75rem 1rem;
            border-radius: var(--radius-lg);
            background: var(--dark-gray);
            box-shadow: var(--shadow-sm);
            display: inline-block;
            border: 1px solid var(--gray);
        }
        
        .message-bubble.bot {
            background: var(--dark-gray);
            border-top-left-radius: 5px;
            border-left: 3px solid var(--primary);
        }
        
        .message-bubble.user {
            background: var(--primary);
            color: var(--white);
            border-top-right-radius: 5px;
            border-right: 3px solid var(--secondary);
        }
        
        .chatbot-input {
            padding: 1rem;
            border-top: 1px solid var(--gray);
            display: flex;
            gap: 0.5rem;
            background: var(--dark-gray);
        }
        
        .chatbot-input input {
            flex: 1;
            padding: 0.75rem;
            border: 1px solid var(--gray);
            border-radius: var(--radius);
            font-family: 'Poppins', sans-serif;
            background: var(--dark);
            color: var(--white);
        }
        
        .quick-questions {
            padding: 1rem;
            border-top: 1px solid var(--gray);
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            background: var(--dark-gray);
        }
        
        .quick-question {
            padding: 0.5rem 0.75rem;
            background: var(--dark);
            border: 1px solid var(--gray);
            border-radius: var(--radius-full);
            font-size: 0.75rem;
            cursor: pointer;
            transition: var(--transition-fast);
            color: var(--light-gray);
        }
        
        .quick-question:hover {
            background: var(--primary);
            color: var(--white);
        }
        
        /* ============================================
           MAIN CONTENT & LAYOUT
        ============================================ */
        .main-container {
            padding-top: 80px;
            min-height: calc(100vh - 200px);
        }
        
        .page {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        .page.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* ============================================
           HERO SECTION
        ============================================ */
        .hero-section {
            padding: 4rem 0;
            background: linear-gradient(135deg, rgba(30, 58, 138, 0.1) 0%, rgba(13, 20, 35, 0.8) 100%);
            border-radius: 0 0 var(--radius-xl) var(--radius-xl);
            margin-bottom: 3rem;
            position: relative;
            overflow: hidden;
        }
        
        .hero-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="none"><path d="M0,0 L100,0 L100,100 Z" fill="rgba(212, 175, 55, 0.03)"/></svg>');
            background-size: cover;
            pointer-events: none;
        }
        
        .hero-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 3rem;
            align-items: center;
            position: relative;
            z-index: 1;
        }
        
        .hero-text h1 {
            margin-bottom: 1rem;
            background: linear-gradient(135deg, var(--secondary), var(--primary-light));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        
        .hero-text p {
            font-size: 1.1rem;
            color: var(--light-gray);
            margin-bottom: 2rem;
            max-width: 500px;
        }
        
        .hero-stats {
            display: flex;
            gap: 2rem;
            margin-top: 2rem;
        }
        
        .stat-item {
            text-align: center;
            background: var(--dark-gray);
            padding: 1rem;
            border-radius: var(--radius);
            border: 1px solid var(--primary);
            min-width: 120px;
        }
        
        .stat-number {
            display: block;
            font-size: 2rem;
            font-weight: 800;
            color: var(--secondary);
            line-height: 1;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        
        .hero-image {
            position: relative;
        }
        
        .hero-image-placeholder {
            width: 100%;
            height: 400px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: var(--radius-xl);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--dark);
            font-size: 1.5rem;
            overflow: hidden;
            box-shadow: var(--shadow-lg);
            border: 2px solid var(--secondary);
        }
        
        /* ============================================
           FEATURES GRID
        ============================================ */
        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin: 4rem 0;
        }
        
        .feature-card {
            background: var(--dark-gray);
            border-radius: var(--radius-lg);
            padding: 2rem;
            text-align: center;
            box-shadow: var(--shadow);
            transition: var(--transition);
            border: 1px solid var(--gray);
            position: relative;
            overflow: hidden;
        }
        
        .feature-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
        }
        
        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary-light);
        }
        
        .feature-icon {
            width: 70px;
            height: 70px;
            margin: 0 auto 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            border-radius: var(--radius-lg);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        
        .feature-icon.primary {
            background: rgba(30, 58, 138, 0.2);
            color: var(--primary-light);
            border: 1px solid rgba(59, 130, 246, 0.3);
        }
        
        .feature-icon.secondary {
            background: rgba(212, 175, 55, 0.2);
            color: var(--secondary);
            border: 1px solid rgba(212, 175, 55, 0.3);
        }
        
        .feature-icon.accent {
            background: rgba(139, 69, 19, 0.2);
            color: var(--accent);
            border: 1px solid rgba(139, 69, 19, 0.3);
        }
        
        /* ============================================
           CONTENT CARDS & GRIDS
        ============================================ */
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .section-title {
            position: relative;
            padding-bottom: 0.5rem;
        }
        
        .section-title::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 60px;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            border-radius: 2px;
        }
        
        .content-tabs {
            display: flex;
            gap: 0.5rem;
            border-bottom: 2px solid var(--gray);
            margin-bottom: 2rem;
            overflow-x: auto;
            padding-bottom: 0.5rem;
        }
        
        .tab-btn {
            padding: 0.75rem 1.5rem;
            background: none;
            border: none;
            color: var(--light-gray);
            font-weight: 600;
            cursor: pointer;
            border-radius: var(--radius) var(--radius) 0 0;
            transition: var(--transition-fast);
            white-space: nowrap;
        }
        
        .tab-btn:hover {
            color: var(--primary-light);
            background: rgba(59, 130, 246, 0.1);
        }
        
        .tab-btn.active {
            color: var(--secondary);
            background: var(--dark-gray);
            border-bottom: 3px solid var(--secondary);
        }
        
        .content-grid {
            display: grid;
            gap: 1.5rem;
        }
        
        .grid-2 { grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); }
        .grid-3 { grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); }
        .grid-4 { grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); }
        
        .card {
            background: var(--dark-gray);
            border-radius: var(--radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: var(--transition);
            cursor: pointer;
            border: 1px solid var(--gray);
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary-light);
        }
        
        .product-card .card-image {
            height: 200px;
            position: relative;
            overflow: hidden;
        }
        
        .product-card .card-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease;
        }
        
        .product-card:hover .card-image img {
            transform: scale(1.05);
        }
        
        .product-card .boost-badge {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: linear-gradient(135deg, var(--secondary), var(--secondary-dark));
            color: var(--dark);
            padding: 0.25rem 0.75rem;
            border-radius: var(--radius-full);
            font-size: 0.75rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.25rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }
        
        .product-card .card-content {
            padding: 1.5rem;
        }
        
        .product-card .card-title {
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--white);
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .product-card .card-price {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--secondary);
            margin-bottom: 1rem;
        }
        
        .social-card .card-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1.5rem 1.5rem 1rem;
        }
        
        .social-card .user-avatar-sm {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--dark);
            font-weight: 600;
        }
        
        .social-card .post-content {
            padding: 0 1.5rem 1rem;
        }
        
        .social-card .post-actions {
            display: flex;
            justify-content: space-around;
            padding: 1rem 1.5rem;
            border-top: 1px solid var(--gray);
        }
        
        .social-card .post-action {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: none;
            border: none;
            color: var(--light-gray);
            cursor: pointer;
            transition: var(--transition-fast);
        }
        
        .social-card .post-action:hover {
            color: var(--primary-light);
        }
        
        .job-card .card-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--gray);
        }
        
        .job-card .job-type {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            background: rgba(30, 58, 138, 0.2);
            color: var(--primary-light);
            border-radius: var(--radius-full);
            font-size: 0.75rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            border: 1px solid rgba(59, 130, 246, 0.3);
        }
        
        .job-card .card-content {
            padding: 1.5rem;
        }
        
        .job-card .job-salary {
            color: var(--secondary);
            font-weight: 600;
            margin: 1rem 0;
        }
        
        /* ============================================
           POST CREATION FORMS
        ============================================ */
        .post-creation-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }
        
        .post-tab {
            padding: 1rem 1.5rem;
            background: var(--dark-gray);
            border: 2px solid var(--gray);
            border-radius: var(--radius);
            color: var(--light-gray);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition-fast);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            flex: 1;
            min-width: 200px;
            justify-content: center;
        }
        
        .post-tab:hover {
            border-color: var(--primary-light);
            color: var(--primary-light);
        }
        
        .post-tab.active {
            border-color: var(--primary-light);
            background: rgba(59, 130, 246, 0.1);
            color: var(--primary-light);
        }
        
        .form-container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .form-card {
            background: var(--dark-gray);
            border-radius: var(--radius-xl);
            padding: 3rem;
            box-shadow: var(--shadow-xl);
            border: 1px solid var(--primary);
        }
        
        .form-title {
            text-align: center;
            margin-bottom: 2rem;
            color: var(--white);
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--white);
        }
        
        .form-control {
            width: 100%;
            padding: 1rem;
            border: 2px solid var(--gray);
            border-radius: var(--radius);
            font-size: 1rem;
            transition: var(--transition-fast);
            font-family: 'Poppins', sans-serif;
            background: var(--dark);
            color: var(--white);
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary-light);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .form-textarea {
            min-height: 150px;
            resize: vertical;
        }
        
        .media-upload {
            border: 2px dashed var(--gray);
            border-radius: var(--radius);
            padding: 3rem 1rem;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            background: var(--dark);
        }
        
        .media-upload:hover {
            border-color: var(--primary-light);
            background: rgba(59, 130, 246, 0.05);
        }
        
        /* ============================================
           DASHBOARD
        ============================================ */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 3rem;
        }
        
        .stat-card {
            background: var(--dark-gray);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 1rem;
            border: 1px solid var(--gray);
        }
        
        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: var(--radius);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }
        
        .stat-content {
            flex: 1;
        }
        
        .stat-value {
            font-size: 1.75rem;
            font-weight: 800;
            line-height: 1;
            margin-bottom: 0.25rem;
            color: var(--white);
        }
        
        .earnings-card {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: var(--white);
            border-radius: var(--radius-xl);
            padding: 2.5rem;
            margin: 3rem 0;
            border: 2px solid var(--secondary);
            box-shadow: var(--shadow-lg);
        }
        
        /* ============================================
           MODALS
        ============================================ */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.85);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 1rem;
        }
        
        .modal.active {
            display: flex;
            animation: fadeIn 0.3s ease;
        }
        
        .modal-content {
            background: var(--dark-gray);
            border-radius: var(--radius-xl);
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideUp 0.3s ease;
            position: relative;
            border: 2px solid var(--primary);
        }
        
        .modal-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--secondary);
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }
        
        .modal-close:hover {
            background: var(--dark);
        }
        
        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        /* ============================================
           NOTIFICATIONS
        ============================================ */
        .notification {
            position: fixed;
            top: 80px;
            right: 1rem;
            padding: 1rem 1.5rem;
            border-radius: var(--radius);
            color: var(--white);
            font-weight: 500;
            box-shadow: var(--shadow-xl);
            z-index: 3000;
            animation: slideIn 0.3s ease;
            max-width: 400px;
            word-wrap: break-word;
            border-left: 4px solid var(--secondary);
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        /* ============================================
           FOOTER
        ============================================ */
        .footer {
            background: var(--dark-gray);
            color: var(--light-gray);
            margin-top: 4rem;
            border-top: 2px solid var(--primary);
        }
        
        .footer-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 3rem;
            padding: 4rem 0;
        }
        
        .footer-bottom {
            text-align: center;
            padding: 2rem 0;
            border-top: 1px solid var(--gray);
            color: var(--light-gray);
            font-size: 0.875rem;
        }
        
        /* ============================================
           RESPONSIVE DESIGN
        ============================================ */
        @media (max-width: 1200px) {
            .hero-content { grid-template-columns: 1fr; }
            .hero-image { order: -1; }
        }
        
        @media (max-width: 768px) {
            .mobile-menu-btn { display: flex; }
            
            .nav-menu {
                position: fixed;
                top: 70px;
                left: -100%;
                width: 100%;
                height: calc(100vh - 70px);
                background: var(--dark-gray);
                flex-direction: column;
                padding: 2rem 1.5rem;
                transition: var(--transition);
                overflow-y: auto;
                gap: 0;
                border-top: 2px solid var(--primary);
            }
            
            .nav-menu.active {
                left: 0;
            }
            
            .nav-links {
                flex-direction: column;
                width: 100%;
                gap: 0.5rem;
                margin-bottom: 2rem;
            }
            
            .nav-link {
                width: 100%;
                justify-content: flex-start;
            }
            
            .user-section {
                flex-direction: column;
                width: 100%;
                gap: 1rem;
                padding-top: 1rem;
                border-top: 1px solid var(--gray);
            }
            
            .hero-content {
                gap: 2rem;
            }
            
            .hero-stats {
                flex-wrap: wrap;
                justify-content: flex-start;
            }
            
            .section-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .form-card {
                padding: 1.5rem;
            }
            
            .chatbot-container {
                width: 90%;
                right: 5%;
                bottom: 80px;
            }
        }
        
        @media (max-width: 576px) {
            .hero-section { padding: 2rem 0; }
            .hero-image-placeholder { height: 250px; }
            .features-grid { grid-template-columns: 1fr; }
            .grid-3, .grid-4 { grid-template-columns: 1fr; }
            .post-tab { min-width: 100%; }
        }
        
        /* ============================================
           UTILITY CLASSES
        ============================================ */
        .text-center { text-align: center; }
        .text-right { text-align: right; }
        .text-left { text-align: left; }
        .mb-1 { margin-bottom: 1rem; }
        .mb-2 { margin-bottom: 2rem; }
        .mb-3 { margin-bottom: 3rem; }
        .mt-1 { margin-top: 1rem; }
        .mt-2 { margin-top: 2rem; }
        .mt-3 { margin-top: 3rem; }
        .w-full { width: 100%; }
        .hidden { display: none !important; }
        .flex { display: flex; }
        .flex-col { flex-direction: column; }
        .items-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .gap-1 { gap: 1rem; }
        .gap-2 { gap: 2rem; }
        .gap-3 { gap: 3rem; }
        
        .badge {
            padding: 0.25rem 0.75rem;
            border-radius: var(--radius-full);
            font-size: 0.75rem;
            font-weight: 600;
            display: inline-block;
        }
        
        .badge-success { background: rgba(16, 185, 129, 0.2); color: var(--success); border: 1px solid rgba(16, 185, 129, 0.3); }
        .badge-warning { background: rgba(245, 158, 11, 0.2); color: var(--warning); border: 1px solid rgba(245, 158, 11, 0.3); }
        .badge-danger { background: rgba(239, 68, 68, 0.2); color: var(--danger); border: 1px solid rgba(239, 68, 68, 0.3); }
        .badge-info { background: rgba(59, 130, 246, 0.2); color: var(--info); border: 1px solid rgba(59, 130, 246, 0.3); }
        .badge-primary { background: rgba(30, 58, 138, 0.2); color: var(--primary-light); border: 1px solid rgba(59, 130, 246, 0.3); }
        .badge-secondary { background: rgba(212, 175, 55, 0.2); color: var(--secondary); border: 1px solid rgba(212, 175, 55, 0.3); }
        
        .empty-state {
            text-align: center;
            padding: 4rem 1rem;
            color: var(--gray);
            grid-column: 1 / -1;
        }
        
        .empty-state i {
            font-size: 4rem;
            margin-bottom: 1rem;
            color: var(--gray);
        }
        
        /* ============================================
           PASSWORD RECOVERY STYLES
        ============================================ */
        .recovery-steps {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }
        
        .step {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: var(--dark);
            border-radius: var(--radius);
            border-left: 4px solid var(--primary);
            border: 1px solid var(--gray);
        }
        
        .step-number {
            width: 30px;
            height: 30px;
            background: var(--primary);
            color: var(--secondary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
        }
        
        /* ============================================
           PROFILE STYLES
        ============================================ */
        .profile-header {
            display: flex;
            align-items: center;
            gap: 2rem;
            margin-bottom: 2rem;
            padding-bottom: 2rem;
            border-bottom: 1px solid var(--gray);
        }
        
        .profile-avatar-lg {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--dark);
            font-size: 2.5rem;
            font-weight: 600;
            border: 3px solid var(--secondary);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        
        .profile-info h3 {
            margin-bottom: 0.5rem;
        }
        
        .profile-info p {
            color: var(--light-gray);
            margin-bottom: 0.5rem;
        }

        /* ============================================
           ADMIN SPECIFIC STYLES
        ============================================ */
        .admin-table {
            width: 100%;
            background: var(--dark);
            border-radius: var(--radius);
            overflow: hidden;
            border: 1px solid var(--gray);
        }
        
        .admin-table th {
            background: var(--primary);
            color: var(--white);
            padding: 1rem;
            text-align: left;
            font-weight: 600;
        }
        
        .admin-table td {
            padding: 1rem;
            border-bottom: 1px solid var(--gray);
            color: var(--light-gray);
        }
        
        .admin-table tr:hover {
            background: var(--dark-gray);
        }
        
        .admin-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        /* ============================================
           PAYMENT OPTIONS STYLES
        ============================================ */
        .payment-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .payment-option {
            background: var(--dark);
            border-radius: var(--radius);
            padding: 1.5rem;
            border: 2px solid var(--gray);
            cursor: pointer;
            transition: var(--transition);
        }
        
        .payment-option:hover {
            border-color: var(--primary-light);
            transform: translateY(-2px);
        }
        
        .payment-option.selected {
            border-color: var(--secondary);
            background: rgba(212, 175, 55, 0.1);
        }
        
        .payment-option-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .payment-option-icon {
            width: 50px;
            height: 50px;
            background: var(--primary);
            border-radius: var(--radius);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--secondary);
            font-size: 1.5rem;
        }
        
        /* ============================================
           NEW: BUSINESS TOOLS STYLES
        ============================================ */
        .business-calculator-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
        }
        
        .calculator-card {
            background: var(--dark-gray);
            border-radius: var(--radius-lg);
            padding: 2rem;
            box-shadow: var(--shadow);
            border: 1px solid var(--primary);
        }
        
        .calculator-title {
            margin-bottom: 1.5rem;
            color: var(--secondary);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .calculator-result {
            margin-top: 1.5rem;
            padding: 1.5rem;
            background: var(--dark);
            border-radius: var(--radius);
            border-left: 4px solid var(--success);
        }
        
        .calculator-history {
            max-height: 300px;
            overflow-y: auto;
            margin-top: 1rem;
        }
        
        .history-item {
            padding: 0.75rem;
            border-bottom: 1px solid var(--gray);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        /* ============================================
           NEW: SHARE MODAL STYLES
        ============================================ */
        .share-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 1rem;
            margin: 1.5rem 0;
        }
        
        .share-option {
            background: var(--dark);
            border: 2px solid var(--gray);
            border-radius: var(--radius);
            padding: 1.5rem 1rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.75rem;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .share-option:hover {
            transform: translateY(-3px);
            border-color: var(--secondary);
        }
        
        .share-option.facebook:hover {
            background: rgba(24, 119, 242, 0.1);
            border-color: #1877F2;
        }
        
        .share-option.twitter:hover {
            background: rgba(29, 161, 242, 0.1);
            border-color: #1DA1F2;
        }
        
        .share-option.whatsapp:hover {
            background: rgba(37, 211, 102, 0.1);
            border-color: #25D366;
        }
        
        .share-option.copy:hover {
            background: rgba(139, 69, 19, 0.1);
            border-color: var(--accent);
        }
        
        .share-option i {
            font-size: 2rem;
        }
        
        .share-option.facebook i { color: #1877F2; }
        .share-option.twitter i { color: #1DA1F2; }
        .share-option.whatsapp i { color: #25D366; }
        .share-option.copy i { color: var(--accent); }
        
        .referral-analytics {
            background: var(--dark);
            border-radius: var(--radius);
            padding: 1.5rem;
            margin-top: 2rem;
        }
    </style>
</head>
<body>
    <!-- Splash Screen -->
    <div class="splash-screen" id="splashScreen">
        <div class="splash-logo">
            <div class="splash-logo-icon">QS</div>
        </div>
        <div class="splash-text">QUICK SHOP</div>
        <p style="color: rgba(212, 175, 55, 0.8); margin-bottom: 2rem;">Marketplace & Social Platform</p>
        <div class="splash-loader">
            <div class="splash-progress" id="splashProgress"></div>
        </div>
    </div>
    
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="nav-container">
                <a href="#" class="logo" onclick="showPage('home'); return false;">
                    <div class="logo-icon">QS</div>
                    <div class="logo-text">
                        QUICK<span>SHOP</span>
                        <span class="logo-tagline">Marketplace & Social</span>
                    </div>
                </a>
                
                <button class="mobile-menu-btn" id="mobileMenuBtn">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
                
                <nav class="nav-menu" id="navMenu">
                    <div class="nav-links" id="navLinks">
                        <!-- Navigation loaded by JavaScript -->
                    </div>
                    
                    <div class="user-section" id="userSection">
                        <!-- User section loaded by JavaScript -->
                    </div>
                </nav>
            </div>
        </div>
    </header>
    
    <!-- Main Content -->
    <main class="main-container">
        <!-- Home Page -->
        <section id="home" class="page active">
            <div class="container">
                <!-- Hero Section -->
                <div class="hero-section">
                    <div class="hero-content">
                        <div class="hero-text">
                            <h1>Sell, Share, Earn</h1>
                            <p>Post products, jobs, and social updates for FREE when subscribed. Earn 50% commission on referrals. Boost posts for maximum visibility.</p>
                            <div class="hero-actions" id="heroActions">
                                <!-- Buttons loaded by JavaScript -->
                            </div>
                            <div class="hero-stats">
                                <div class="stat-item">
                                    <span class="stat-number" id="totalUsers">0</span>
                                    <span>Active Users</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-number" id="totalPosts">0</span>
                                    <span>Total Posts</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-number" id="totalEarnings">KES 0</span>
                                    <span>Paid Out</span>
                                </div>
                            </div>
                        </div>
                        <div class="hero-image">
                            <div class="hero-image-placeholder">
                                <div style="text-align: center; padding: 2rem;">
                                    <i class="fas fa-store" style="font-size: 4rem; margin-bottom: 1rem; color: var(--dark);"></i>
                                    <h3 style="color: var(--dark);">Marketplace + Social + Jobs</h3>
                                    <p style="color: rgba(13, 20, 35, 0.9);">All in one platform</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- How It Works -->
                <div class="mb-3">
                    <div class="section-header">
                        <h2 class="section-title">How It Works</h2>
                    </div>
                    <div class="features-grid">
                        <div class="feature-card">
                            <div class="feature-icon primary">
                                <i class="fas fa-user-plus"></i>
                            </div>
                            <h3>Subscribe (KES 50)</h3>
                            <p>Weekly subscription gives you unlimited free posts. Admin approval required after payment.</p>
                        </div>
                        
                        <div class="feature-card">
                            <div class="feature-icon secondary">
                                <i class="fas fa-upload"></i>
                            </div>
                            <h3>Post for Free</h3>
                            <p>Upload products, jobs, or social posts with images/videos. No additional fees for subscribers.</p>
                        </div>
                        
                        <div class="feature-card">
                            <div class="feature-icon accent">
                                <i class="fas fa-rocket"></i>
                            </div>
                            <h3>Boost Posts (KES 100)</h3>
                            <p>Pay KES 100 to boost your posts for maximum visibility and reach.</p>
                        </div>
                        
                        <div class="feature-card">
                            <div class="feature-icon primary">
                                <i class="fas fa-money-bill-wave"></i>
                            </div>
                            <h3>Earn 50% Commission</h3>
                            <p>Refer friends and earn KES 25 when they subscribe (admin approval required).</p>
                        </div>
                    </div>
                </div>
                
                <!-- Payment Methods -->
                <div class="mb-3">
                    <div class="section-header">
                        <h2 class="section-title">Payment Methods</h2>
                    </div>
                    <div class="content-grid grid-3">
                        <div class="feature-card">
                            <div class="feature-icon primary">
                                <i class="fas fa-mobile-alt"></i>
                            </div>
                            <h3>M-Pesa</h3>
                            <p><strong>Paybill:</strong> 222111<br>
                               <strong>Account:</strong> 5414200<br>
                               <strong>Amount:</strong> KES 50 (Weekly)</p>
                        </div>
                        
                        <div class="feature-card">
                            <div class="feature-icon secondary">
                                <i class="fab fa-whatsapp"></i>
                            </div>
                            <h3>WhatsApp Support</h3>
                            <p><strong>Number:</strong> +254 712 883849<br>
                               <strong>Support:</strong> 24/7<br>
                               <strong>Queries:</strong> Payments & Help</p>
                        </div>
                        
                        <div class="feature-card">
                            <div class="feature-icon accent">
                                <i class="fas fa-user-shield"></i>
                            </div>
                            <h3>Admin Approval</h3>
                            <p>All subscriptions require admin approval after payment. Contact admin if not activated within 24 hours.</p>
                        </div>
                    </div>
                </div>
                
                <!-- Content Tabs -->
                <div class="content-tabs" id="homeContentTabs">
                    <button class="tab-btn active" onclick="showHomeTab('products')">
                        <i class="fas fa-box"></i> Products
                    </button>
                    <button class="tab-btn" onclick="showHomeTab('social')">
                        <i class="fas fa-users"></i> Social Posts
                    </button>
                    <button class="tab-btn" onclick="showHomeTab('jobs')">
                        <i class="fas fa-briefcase"></i> Jobs
                    </button>
                    <button class="tab-btn" onclick="showHomeTab('boosted')">
                        <i class="fas fa-rocket"></i> Boosted
                    </button>
                </div>
                
                <!-- Content Areas -->
                <div id="productsTab" class="content-tab">
                    <div class="content-grid grid-3" id="featuredProducts">
                        <!-- Products loaded by JavaScript -->
                    </div>
                </div>
                
                <div id="socialTab" class="content-tab" style="display: none;">
                    <div class="content-grid grid-2" id="featuredSocial">
                        <!-- Social posts loaded by JavaScript -->
                    </div>
                </div>
                
                <div id="jobsTab" class="content-tab" style="display: none;">
                    <div class="content-grid grid-3" id="featuredJobs">
                        <!-- Jobs loaded by JavaScript -->
                    </div>
                </div>
                
                <div id="boostedTab" class="content-tab" style="display: none;">
                    <div class="content-grid grid-3" id="featuredBoosted">
                        <!-- Boosted content loaded by JavaScript -->
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Marketplace -->
        <section id="marketplace" class="page">
            <div class="container">
                <div class="section-header">
                    <h2 class="section-title">Marketplace</h2>
                    <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                        <input type="text" id="marketplaceSearch" class="form-control" placeholder="Search posts..." style="min-width: 200px;">
                        <select id="marketplaceCategory" class="form-control">
                            <option value="">All Categories</option>
                            <option value="products">Products</option>
                            <option value="social">Social Posts</option>
                            <option value="jobs">Jobs</option>
                        </select>
                        <select id="marketplaceSort" class="form-control">
                            <option value="newest">Newest First</option>
                            <option value="oldest">Oldest First</option>
                            <option value="price-low">Price: Low to High</option>
                            <option value="price-high">Price: High to Low</option>
                            <option value="boosted">Boosted First</option>
                        </select>
                    </div>
                </div>
                
                <div class="content-grid grid-3" id="marketplaceContent">
                    <!-- Marketplace content loaded by JavaScript -->
                </div>
            </div>
        </section>
        
        <!-- Create Post -->
        <section id="create-post" class="page">
            <div class="container">
                <div class="form-container">
                    <div class="form-card">
                        <h2 class="form-title">Create New Post</h2>
                        <p class="text-center mb-3" style="color: var(--light-gray);">Free posting for subscribed users</p>
                        
                        <!-- Post Type Tabs -->
                        <div class="post-creation-tabs">
                            <div class="post-tab active" onclick="showPostForm('product')">
                                <i class="fas fa-box"></i>
                                <span>Product</span>
                            </div>
                            <div class="post-tab" onclick="showPostForm('social')">
                                <i class="fas fa-users"></i>
                                <span>Social Post</span>
                            </div>
                            <div class="post-tab" onclick="showPostForm('job')">
                                <i class="fas fa-briefcase"></i>
                                <span>Job Listing</span>
                            </div>
                        </div>
                        
                        <!-- Product Form -->
                        <form id="productForm" class="post-form active">
                            <div class="form-group">
                                <label class="form-label">Product Title *</label>
                                <input type="text" class="form-control" id="productTitle" placeholder="e.g., iPhone 13 Pro Max 256GB" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Description *</label>
                                <textarea class="form-control form-textarea" id="productDescription" placeholder="Describe your product in detail..." required></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Product Images/Videos</label>
                                <div class="upload-area" onclick="document.getElementById('productMedia').click()">
                                    <i class="fas fa-cloud-upload-alt"></i>
                                    <p>Click to upload images/videos</p>
                                    <small style="color: var(--light-gray);">Max 10 files, 10MB each</small>
                                </div>
                                <input type="file" id="productMedia" accept="image/*,video/*" multiple style="display: none;" onchange="previewMedia('productMedia', 'productMediaPreview')">
                                <div id="productMediaPreview" class="media-preview-container"></div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Price (KES) *</label>
                                <input type="number" class="form-control" id="productPrice" placeholder="e.g., 85000" min="1" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Category *</label>
                                <select class="form-control" id="productCategory" required>
                                    <option value="">Select Category</option>
                                    <option value="electronics">Electronics</option>
                                    <option value="fashion">Fashion</option>
                                    <option value="home">Home & Garden</option>
                                    <option value="vehicles">Vehicles</option>
                                    <option value="real-estate">Real Estate</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Location *</label>
                                <input type="text" class="form-control" id="productLocation" placeholder="e.g., Nairobi, Mombasa" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Contact WhatsApp *</label>
                                <input type="text" class="form-control" id="productWhatsapp" placeholder="2547XXXXXXXX" pattern="^2547\d{8}$" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">
                                    <input type="checkbox" id="boostProduct" style="margin-right: 0.5rem;">
                                    Boost this post for KES 100 (Increased visibility)
                                </label>
                            </div>
                            
                            <button type="submit" class="btn btn-primary w-full btn-lg">
                                <i class="fas fa-plus-circle"></i> Post Product
                            </button>
                        </form>
                        
                        <!-- Social Post Form -->
                        <form id="socialForm" class="post-form">
                            <div class="form-group">
                                <label class="form-label">What's on your mind? *</label>
                                <textarea class="form-control form-textarea" id="socialContent" placeholder="Share your thoughts, updates, or announcements..." rows="6" required></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Add Images/Videos</label>
                                <div class="upload-area" onclick="document.getElementById('socialMedia').click()">
                                    <i class="fas fa-cloud-upload-alt"></i>
                                    <p>Click to upload images/videos</p>
                                    <small style="color: var(--light-gray);">Max 10 files, 10MB each</small>
                                </div>
                                <input type="file" id="socialMedia" accept="image/*,video/*" multiple style="display: none;" onchange="previewMedia('socialMedia', 'socialMediaPreview')">
                                <div id="socialMediaPreview" class="media-preview-container"></div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">
                                    <input type="checkbox" id="boostSocial" style="margin-right: 0.5rem;">
                                    Boost this post for KES 100 (Reach more people)
                                </label>
                            </div>
                            
                            <button type="submit" class="btn btn-secondary w-full btn-lg">
                                <i class="fas fa-share"></i> Share Post
                            </button>
                        </form>
                        
                        <!-- Job Form -->
                        <form id="jobForm" class="post-form">
                            <div class="form-group">
                                <label class="form-label">Job Title *</label>
                                <input type="text" class="form-control" id="jobTitle" placeholder="e.g., Software Developer, Sales Manager" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Company/Organization *</label>
                                <input type="text" class="form-control" id="jobCompany" placeholder="Your company name" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Job Description *</label>
                                <textarea class="form-control form-textarea" id="jobDescription" placeholder="Describe the job responsibilities, requirements..." required></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Job Type *</label>
                                <select class="form-control" id="jobType" required>
                                    <option value="">Select Type</option>
                                    <option value="full-time">Full Time</option>
                                    <option value="part-time">Part Time</option>
                                    <option value="contract">Contract</option>
                                    <option value="internship">Internship</option>
                                    <option value="remote">Remote</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Salary Range (KES) *</label>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                    <input type="number" class="form-control" id="jobSalaryMin" placeholder="Minimum" required>
                                    <input type="number" class="form-control" id="jobSalaryMax" placeholder="Maximum" required>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Location *</label>
                                <input type="text" class="form-control" id="jobLocation" placeholder="e.g., Nairobi, Remote, Hybrid" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Contact WhatsApp *</label>
                                <input type="text" class="form-control" id="jobWhatsapp" placeholder="2547XXXXXXXX" pattern="^2547\d{8}$" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Application Email/URL *</label>
                                <input type="text" class="form-control" id="jobApply" placeholder="Email or application link" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Company Images/Videos (Optional)</label>
                                <div class="upload-area" onclick="document.getElementById('jobMedia').click()">
                                    <i class="fas fa-cloud-upload-alt"></i>
                                    <p>Upload company/office images</p>
                                    <small style="color: var(--light-gray);">Max 5 files, 10MB each</small>
                                </div>
                                <input type="file" id="jobMedia" accept="image/*,video/*" multiple style="display: none;" onchange="previewMedia('jobMedia', 'jobMediaPreview')">
                                <div id="jobMediaPreview" class="media-preview-container"></div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">
                                    <input type="checkbox" id="boostJob" style="margin-right: 0.5rem;">
                                    Boost this job post for KES 100 (Get more applicants)
                                </label>
                            </div>
                            
                            <button type="submit" class="btn btn-accent w-full btn-lg">
                                <i class="fas fa-briefcase"></i> Post Job
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Dashboard -->
        <section id="dashboard" class="page">
            <div class="container">
                <div class="profile-header">
                    <div class="profile-avatar-lg" id="profileAvatar">
                        <!-- Avatar loaded by JavaScript -->
                    </div>
                    <div class="profile-info">
                        <h3 id="profileName"></h3>
                        <p id="profileEmail"></p>
                        <p id="profilePhone"></p>
                        <div id="profileStatus"></div>
                        <button class="btn btn-sm btn-outline" onclick="showPage('profile')">
                            <i class="fas fa-user-edit"></i> Edit Profile
                        </button>
                        <button class="btn btn-sm btn-secondary" onclick="showPage('business-tools')" style="margin-left: 0.5rem;">
                            <i class="fas fa-calculator"></i> Business Tools
                        </button>
                    </div>
                </div>
                
                <!-- Quick Stats -->
                <div class="dashboard-grid">
                    <div class="stat-card">
                        <div class="stat-icon" style="background: rgba(30, 58, 138, 0.2); color: var(--primary-light); border: 1px solid rgba(59, 130, 246, 0.3);">
                            <i class="fas fa-box"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-value" id="myProductsCount">0</div>
                            <div>My Products</div>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon" style="background: rgba(212, 175, 55, 0.2); color: var(--secondary); border: 1px solid rgba(212, 175, 55, 0.3);">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-value" id="mySocialPosts">0</div>
                            <div>Social Posts</div>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon" style="background: rgba(139, 69, 19, 0.2); color: var(--accent); border: 1px solid rgba(139, 69, 19, 0.3);">
                            <i class="fas fa-briefcase"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-value" id="myJobsCount">0</div>
                            <div>Job Listings</div>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon" style="background: rgba(16, 185, 129, 0.2); color: var(--success); border: 1px solid rgba(16, 185, 129, 0.3);">
                            <i class="fas fa-money-bill-wave"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-value" id="myEarnings">KES 0</div>
                            <div>Total Earnings</div>
                        </div>
                    </div>
                </div>
                
                <!-- Earnings & Referrals Section -->
                <div class="earnings-card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; flex-wrap: wrap; gap: 1rem;">
                        <div>
                            <h3 style="color: var(--secondary); margin-bottom: 0.5rem;">Earnings & Referrals</h3>
                            <p style="opacity: 0.9;">Earn 50% commission on every successful referral</p>
                        </div>
                        <span class="badge badge-secondary">50% Commission</span>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1.5rem; margin-bottom: 2rem; color: white;">
                        <div style="text-align: center;">
                            <div style="font-size: 2rem; font-weight: bold; color: var(--secondary);">KES 25</div>
                            <div style="font-size: 0.875rem; opacity: 0.8;">Per Referral</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 2rem; font-weight: bold; color: var(--secondary);" id="totalReferrals">0</div>
                            <div style="font-size: 0.875rem; opacity: 0.8;">Successful Referrals</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 2rem; font-weight: bold; color: var(--secondary);" id="earnedAmount">KES 0</div>
                            <div style="font-size: 0.875rem; opacity: 0.8;">Total Earned</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 2rem; font-weight: bold; color: var(--secondary);" id="withdrawnAmount">KES 0</div>
                            <div style="font-size: 0.875rem; opacity: 0.8;">Withdrawn</div>
                        </div>
                    </div>
                    
                    <!-- Referral Link -->
                    <div style="background: rgba(255, 255, 255, 0.05); padding: 1.5rem; border-radius: var(--radius); margin-bottom: 2rem;">
                        <label style="color: white; margin-bottom: 0.5rem; display: block;">Your Referral Link</label>
                        <div style="display: flex; gap: 1rem;">
                            <input type="text" class="form-control" id="referralLink" readonly 
                                   style="background: rgba(255, 255, 255, 0.1); border-color: rgba(255, 255, 255, 0.2); color: white;">
                            <button class="btn btn-secondary" onclick="copyReferralLink()">
                                <i class="fas fa-copy"></i> Copy
                            </button>
                            <button class="btn btn-primary" onclick="shareReferralLink()">
                                <i class="fas fa-share"></i> Share
                            </button>
                        </div>
                        <small style="color: rgba(255, 255, 255, 0.7); margin-top: 0.5rem; display: block;">
                            Share this link. Earn KES 25 when friends subscribe.
                        </small>
                        <div style="margin-top: 1rem; font-size: 0.875rem;">
                            <strong>Referral Analytics:</strong>
                            <div style="display: flex; gap: 1rem; margin-top: 0.5rem;">
                                <span><i class="fas fa-eye"></i> Views: <span id="referralViews">0</span></span>
                                <span><i class="fas fa-click"></i> Clicks: <span id="referralClicks">0</span></span>
                                <span><i class="fas fa-user-check"></i> Signups: <span id="referralSignups">0</span></span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Withdrawal Form -->
                    <div>
                        <h4 style="color: white; margin-bottom: 1rem;">Withdraw Earnings</h4>
                        <form id="withdrawalForm">
                            <div class="form-group">
                                <input type="number" class="form-control" id="withdrawalAmount" 
                                       placeholder="Amount (KES)" min="100" 
                                       style="background: rgba(255, 255, 255, 0.1); border-color: rgba(255, 255, 255, 0.2); color: white;">
                                <small style="color: rgba(255, 255, 255, 0.7);">Minimum: KES 100</small>
                            </div>
                            
                            <div class="form-group">
                                <input type="text" class="form-control" id="withdrawalMpesa" 
                                       placeholder="M-Pesa Number (2547XXXXXXXX)" 
                                       style="background: rgba(255, 255, 255, 0.1); border-color: rgba(255, 255, 255, 0.2); color: white;">
                            </div>
                            
                            <button type="submit" class="btn btn-secondary w-full">
                                <i class="fas fa-paper-plane"></i> Request Withdrawal
                            </button>
                        </form>
                    </div>
                </div>
                
                <!-- My Posts Tabs -->
                <div class="content-tabs">
                    <button class="tab-btn active" onclick="showDashboardTab('myProducts')">
                        <i class="fas fa-box"></i> My Products
                    </button>
                    <button class="tab-btn" onclick="showDashboardTab('mySocial')">
                        <i class="fas fa-users"></i> My Social Posts
                    </button>
                    <button class="tab-btn" onclick="showDashboardTab('myJobs')">
                        <i class="fas fa-briefcase"></i> My Jobs
                    </button>
                    <button class="tab-btn" onclick="showDashboardTab('myBoosted')">
                        <i class="fas fa-rocket"></i> Boosted Posts
                    </button>
                </div>
                
                <!-- Content Areas -->
                <div id="myProductsTab" class="dashboard-tab">
                    <div class="content-grid grid-3" id="myProductsGrid">
                        <!-- User's products loaded by JavaScript -->
                    </div>
                </div>
                
                <div id="mySocialTab" class="dashboard-tab" style="display: none;">
                    <div class="content-grid grid-2" id="mySocialGrid">
                        <!-- User's social posts loaded by JavaScript -->
                    </div>
                </div>
                
                <div id="myJobsTab" class="dashboard-tab" style="display: none;">
                    <div class="content-grid grid-3" id="myJobsGrid">
                        <!-- User's jobs loaded by JavaScript -->
                    </div>
                </div>
                
                <div id="myBoostedTab" class="dashboard-tab" style="display: none;">
                    <div class="content-grid grid-3" id="myBoostedGrid">
                        <!-- User's boosted posts loaded by JavaScript -->
                    </div>
                </div>
            </div>
        </section>
        
        <!-- NEW: Business Tools Page -->
        <section id="business-tools" class="page">
            <div class="container">
                <div class="section-header">
                    <h2 class="section-title">Business Tools</h2>
                    <p style="color: var(--light-gray);">Calculate profits, margins, and track your business performance</p>
                </div>
                
                <div class="business-calculator-grid">
                    <!-- Profit Calculator -->
                    <div class="calculator-card">
                        <h3 class="calculator-title">
                            <i class="fas fa-chart-line"></i> Profit Calculator
                        </h3>
                        <form id="profitCalculator">
                            <div class="form-group">
                                <label class="form-label">Total Revenue (KES)</label>
                                <input type="number" class="form-control" id="revenue" placeholder="Enter total sales" min="0" step="1">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Total Costs (KES)</label>
                                <input type="number" class="form-control" id="costs" placeholder="Enter all costs" min="0" step="1">
                            </div>
                            
                            <button type="submit" class="btn btn-primary w-full">
                                <i class="fas fa-calculator"></i> Calculate Profit
                            </button>
                        </form>
                        
                        <div id="profitResult" class="calculator-result" style="display: none;">
                            <h4>Calculation Results</h4>
                            <div style="margin-top: 1rem;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                    <span>Revenue:</span>
                                    <span id="resultRevenue">KES 0</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                    <span>Costs:</span>
                                    <span id="resultCosts">KES 0</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem; font-weight: 600;">
                                    <span>Profit:</span>
                                    <span id="resultProfit" style="color: var(--success);">KES 0</span>
                                </div>
                                <div style="display: flex; justify-content: space-between;">
                                    <span>Profit Margin:</span>
                                    <span id="resultMargin" style="color: var(--secondary);">0%</span>
                                </div>
                            </div>
                            <button class="btn btn-sm btn-outline w-full mt-2" onclick="saveProfitCalculation()">
                                <i class="fas fa-save"></i> Save Calculation
                            </button>
                        </div>
                    </div>
                    
                    <!-- Sales Tracker -->
                    <div class="calculator-card">
                        <h3 class="calculator-title">
                            <i class="fas fa-shopping-cart"></i> Sales Tracker
                        </h3>
                        <form id="salesTracker">
                            <div class="form-group">
                                <label class="form-label">Product Sales (KES)</label>
                                <input type="number" class="form-control" id="productSales" placeholder="Product income" min="0">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Other Income (KES)</label>
                                <input type="number" class="form-control" id="otherIncome" placeholder="Other sources" min="0">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Operating Costs (KES)</label>
                                <input type="number" class="form-control" id="operatingCosts" placeholder="Monthly expenses" min="0">
                            </div>
                            
                            <button type="submit" class="btn btn-secondary w-full">
                                <i class="fas fa-chart-pie"></i> Calculate Net
                            </button>
                        </form>
                        
                        <div id="salesResult" class="calculator-result" style="display: none;">
                            <h4>Monthly Summary</h4>
                            <div style="margin-top: 1rem;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                    <span>Total Income:</span>
                                    <span id="totalIncome">KES 0</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                    <span>Total Costs:</span>
                                    <span id="totalCosts">KES 0</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem; font-weight: 600;">
                                    <span>Net Income:</span>
                                    <span id="netIncome" style="color: var(--success);">KES 0</span>
                                </div>
                                <div style="display: flex; justify-content: space-between;">
                                    <span>Monthly Growth:</span>
                                    <span id="monthlyGrowth" style="color: var(--secondary);">0%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ROI Calculator -->
                    <div class="calculator-card">
                        <h3 class="calculator-title">
                            <i class="fas fa-hand-holding-usd"></i> ROI Calculator
                        </h3>
                        <form id="roiCalculator">
                            <div class="form-group">
                                <label class="form-label">Investment (KES)</label>
                                <input type="number" class="form-control" id="investment" placeholder="Initial investment" min="0">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Return (KES)</label>
                                <input type="number" class="form-control" id="returnAmount" placeholder="Total return" min="0">
                            </div>
                            
                            <button type="submit" class="btn btn-accent w-full">
                                <i class="fas fa-percentage"></i> Calculate ROI
                            </button>
                        </form>
                        
                        <div id="roiResult" class="calculator-result" style="display: none;">
                            <h4>ROI Analysis</h4>
                            <div style="margin-top: 1rem;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                    <span>Investment:</span>
                                    <span id="roiInvestment">KES 0</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                    <span>Return:</span>
                                    <span id="roiReturn">KES 0</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem; font-weight: 600;">
                                    <span>Net Gain:</span>
                                    <span id="netGain" style="color: var(--success);">KES 0</span>
                                </div>
                                <div style="display: flex; justify-content: space-between;">
                                    <span>ROI Percentage:</span>
                                    <span id="roiPercentage" style="color: var(--secondary);">0%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Calculation History -->
                    <div class="calculator-card" style="grid-column: span 2;">
                        <h3 class="calculator-title">
                            <i class="fas fa-history"></i> Calculation History
                        </h3>
                        <div class="calculator-history" id="calculationHistory">
                            <p style="color: var(--light-gray); text-align: center; padding: 2rem;">No calculations saved yet</p>
                        </div>
                        <div style="display: flex; gap: 1rem; margin-top: 1rem;">
                            <button class="btn btn-outline" onclick="clearCalculationHistory()">
                                <i class="fas fa-trash"></i> Clear History
                            </button>
                            <button class="btn btn-secondary" onclick="exportCalculations()">
                                <i class="fas fa-download"></i> Export as CSV
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Profile Page -->
        <section id="profile" class="page">
            <div class="container">
                <div class="form-container">
                    <div class="form-card">
                        <h2 class="form-title">Edit Profile</h2>
                        <form id="profileForm">
                            <div class="form-group">
                                <label class="form-label">Profile Picture</label>
                                <div class="upload-area" onclick="document.getElementById('profilePicture').click()">
                                    <i class="fas fa-user-circle"></i>
                                    <p>Click to upload profile picture</p>
                                    <small style="color: var(--light-gray);">Max 5MB, JPG/PNG</small>
                                </div>
                                <input type="file" id="profilePicture" accept="image/*" style="display: none;" onchange="previewProfilePicture()">
                                <div id="profilePicturePreview" class="mt-2" style="text-align: center;"></div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Full Name *</label>
                                <input type="text" class="form-control" id="profileNameInput" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Email Address *</label>
                                <input type="email" class="form-control" id="profileEmailInput" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Phone Number *</label>
                                <input type="text" class="form-control" id="profilePhoneInput" placeholder="2547XXXXXXXX" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Location</label>
                                <input type="text" class="form-control" id="profileLocation" placeholder="Your city">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Bio</label>
                                <textarea class="form-control form-textarea" id="profileBio" placeholder="Tell us about yourself..."></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Change Password</label>
                                <input type="password" class="form-control" id="profileCurrentPassword" placeholder="Current password">
                                <input type="password" class="form-control mt-2" id="profileNewPassword" placeholder="New password">
                                <input type="password" class="form-control mt-2" id="profileConfirmPassword" placeholder="Confirm new password">
                            </div>
                            
                            <button type="submit" class="btn btn-primary w-full">
                                <i class="fas fa-save"></i> Save Changes
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Admin Panel -->
        <section id="admin" class="page">
            <div class="container">
                <h2 class="section-title">Admin Panel</h2>
                
                <!-- Admin Stats -->
                <div class="dashboard-grid">
                    <div class="stat-card">
                        <div class="stat-icon" style="background: rgba(30, 58, 138, 0.2); color: var(--primary-light); border: 1px solid rgba(59, 130, 246, 0.3);">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-value" id="adminUsers">0</div>
                            <div>Total Users</div>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon" style="background: rgba(212, 175, 55, 0.2); color: var(--secondary); border: 1px solid rgba(212, 175, 55, 0.3);">
                            <i class="fas fa-file-alt"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-value" id="adminPosts">0</div>
                            <div>Total Posts</div>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon" style="background: rgba(139, 69, 19, 0.2); color: var(--accent); border: 1px solid rgba(139, 69, 19, 0.3);">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-value" id="adminPending">0</div>
                            <div>Pending Approvals</div>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon" style="background: rgba(16, 185, 129, 0.2); color: var(--success); border: 1px solid rgba(16, 185, 129, 0.3);">
                            <i class="fas fa-money-bill-wave"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-value" id="adminRevenue">KES 0</div>
                            <div>Total Revenue</div>
                        </div>
                    </div>
                </div>
                
                <!-- Admin Tabs -->
                <div class="content-tabs">
                    <button class="tab-btn active" onclick="showAdminTab('pending')">
                        <i class="fas fa-clock"></i> Pending Approvals
                    </button>
                    <button class="tab-btn" onclick="showAdminTab('withdrawals')">
                        <i class="fas fa-wallet"></i> Pending Withdrawals
                    </button>
                    <button class="tab-btn" onclick="showAdminTab('users')">
                        <i class="fas fa-users"></i> All Users
                    </button>
                    <button class="tab-btn" onclick="showAdminTab('posts')">
                        <i class="fas fa-list"></i> All Posts
                    </button>
                    <button class="tab-btn" onclick="showAdminTab('referrals')">
                        <i class="fas fa-share-alt"></i> Referral Analytics
                    </button>
                    <button class="tab-btn" onclick="showAdminTab('settings')">
                        <i class="fas fa-cog"></i> Settings
                    </button>
                </div>
                
                <!-- Admin Content -->
                <div id="adminContent">
                    <!-- Content loaded by JavaScript -->
                </div>
            </div>
        </section>
        
        <!-- Register Page -->
        <section id="register" class="page">
            <div class="container">
                <div class="form-container">
                    <div class="form-card">
                        <h2 class="form-title">Join QUICK SHOP</h2>
                        <form id="registerForm">
                            <!-- Form loaded by JavaScript -->
                        </form>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Login Page -->
        <section id="login" class="page">
            <div class="container">
                <div class="form-container">
                    <div class="form-card">
                        <h2 class="form-title">Welcome Back</h2>
                        <form id="loginForm">
                            <!-- Form loaded by JavaScript -->
                        </form>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Forgot Password -->
        <section id="forgot-password" class="page">
            <div class="container">
                <div class="form-container">
                    <div class="form-card">
                        <h2 class="form-title">Reset Password</h2>
                        <div id="forgotPasswordForm">
                            <!-- Form loaded by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Subscription Page -->
        <section id="subscribe" class="page">
            <div class="container">
                <div class="form-container">
                    <div class="form-card">
                        <h2 class="form-title">Subscribe to Post</h2>
                        <p class="text-center mb-3" style="color: var(--light-gray);">KES 50/week for unlimited posts</p>
                        <div id="subscriptionForm">
                            <!-- Form loaded by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>
    
    <!-- Chatbot -->
    <div class="chatbot-toggle" id="chatbotToggle">
        <i class="fas fa-comments"></i>
    </div>
    
    <div class="chatbot-container" id="chatbotContainer">
        <div class="chatbot-header">
            <div>
                <h4 style="margin: 0; color: var(--secondary);">Quick Shop Assistant</h4>
                <small style="opacity: 0.8; color: var(--light-gray);">Online</small>
            </div>
            <button class="chatbot-close" id="chatbotClose">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="chatbot-messages" id="chatbotMessages">
            <!-- Messages loaded by JavaScript -->
        </div>
        <div class="quick-questions">
            <button class="quick-question" onclick="sendQuickQuestion('How do I post?')">How to post?</button>
            <button class="quick-question" onclick="sendQuickQuestion('Subscription cost?')">Subscription?</button>
            <button class="quick-question" onclick="sendQuickQuestion('How to earn?')">How to earn?</button>
            <button class="quick-question" onclick="sendQuickQuestion('Contact admin')">Contact admin</button>
        </div>
        <div class="chatbot-input">
            <input type="text" id="chatbotInput" placeholder="Type your question...">
            <button class="btn btn-primary" onclick="sendChatMessage()">
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>
    </div>
    
    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-grid">
                <div>
                    <div class="logo" style="margin-bottom: 1rem;">
                        <div class="logo-icon" style="width: 40px; height: 40px; font-size: 1rem;">QS</div>
                        <div class="logo-text" style="font-size: 1.5rem;">
                            QUICK<span>SHOP</span>
                            <span class="logo-tagline">Marketplace & Social</span>
                        </div>
                    </div>
                    <p style="color: var(--light-gray); font-size: 0.875rem;">
                        Sell products, post jobs, share updates. Earn through referrals.
                    </p>
                </div>
                
                <div>
                    <h4 style="color: var(--secondary); margin-bottom: 1.5rem;">Quick Links</h4>
                    <ul style="list-style: none;">
                        <li><a href="#" onclick="showPage('home'); return false;" style="color: var(--light-gray); text-decoration: none; transition: var(--transition-fast); display: block; margin-bottom: 0.75rem;">Home</a></li>
                        <li><a href="#" onclick="showPage('marketplace'); return false;" style="color: var(--light-gray); text-decoration: none; transition: var(--transition-fast); display: block; margin-bottom: 0.75rem;">Marketplace</a></li>
                        <li><a href="#" onclick="showPage('create-post'); return false;" style="color: var(--light-gray); text-decoration: none; transition: var(--transition-fast); display: block; margin-bottom: 0.75rem;">Create Post</a></li>
                        <li><a href="#" onclick="showPage('dashboard'); return false;" style="color: var(--light-gray); text-decoration: none; transition: var(--transition-fast); display: block; margin-bottom: 0.75rem;">Dashboard</a></li>
                        <li><a href="#" onclick="showPage('business-tools'); return false;" style="color: var(--light-gray); text-decoration: none; transition: var(--transition-fast); display: block; margin-bottom: 0.75rem;">Business Tools</a></li>
                    </ul>
                </div>
                
                <div>
                    <h4 style="color: var(--secondary); margin-bottom: 1.5rem;">Support</h4>
                    <ul style="list-style: none;">
                        <li><a href="#" onclick="toggleChatbot(); return false;" style="color: var(--light-gray); text-decoration: none; transition: var(--transition-fast); display: block; margin-bottom: 0.75rem;">Live Chat</a></li>
                        <li><a href="#" style="color: var(--light-gray); text-decoration: none; transition: var(--transition-fast); display: block; margin-bottom: 0.75rem;">Help Center</a></li>
                        <li><a href="#" style="color: var(--light-gray); text-decoration: none; transition: var(--transition-fast); display: block; margin-bottom: 0.75rem;">FAQ</a></li>
                        <li><a href="#" style="color: var(--light-gray); text-decoration: none; transition: var(--transition-fast); display: block; margin-bottom: 0.75rem;">Terms & Privacy</a></li>
                    </ul>
                </div>
                
                <div>
                    <h4 style="color: var(--secondary); margin-bottom: 1.5rem;">Payment Info</h4>
                    <ul style="list-style: none;">
                        <li style="color: var(--light-gray); margin-bottom: 0.75rem;"><strong>Paybill:</strong> 222111</li>
                        <li style="color: var(--light-gray); margin-bottom: 0.75rem;"><strong>Account:</strong> 5414200</li>
                        <li style="color: var(--light-gray); margin-bottom: 0.75rem;"><strong>Subscription:</strong> KES 50/week</li>
                        <li style="color: var(--light-gray); margin-bottom: 0.75rem;"><strong>Boost:</strong> KES 100/post</li>
                        <li style="color: var(--light-gray); margin-bottom: 0.75rem;"><strong>WhatsApp Support:</strong> +254 712 883849</li>
                    </ul>
                </div>
            </div>
            
            <div class="footer-bottom">
                &copy; 2026 QUICK SHOP. All rights reserved. | WhatsApp Support: +254 712 883849
            </div>
        </div>
    </footer>
    
    <!-- Modals -->
    <div class="modal" id="postModal">
        <div class="modal-content">
            <!-- Modal content loaded by JavaScript -->
        </div>
    </div>
    
    <div class="modal" id="paymentModal">
        <div class="modal-content">
            <!-- Payment modal loaded by JavaScript -->
        </div>
    </div>
    
    <!-- NEW: Share Modal -->
    <div class="modal" id="shareModal">
        <div class="modal-content">
            <!-- Share modal loaded by JavaScript -->
        </div>
    </div>
    
    <!-- Notification Container -->
    <div id="notificationContainer"></div>
    
    <script>
        // ============================================
        // ENHANCED APPLICATION STATE
        // ============================================
        
        const AppState = {
            currentUser: null,
            users: [],
            posts: [],
            payments: [],
            withdrawals: [],
            referrals: [],
            subscriptions: [],
            boosts: [],
            passwordResetTokens: [],
            chatMessages: [],
            userSettings: [],
            calculations: [],
            referralAnalytics: [],
            shareAnalytics: [],
            
            settings: {
                subscriptionPrice: 50,
                boostPrice: 100,
                referralCommission: 0.50,
                adminEmail: 'techray91@gmail.com',
                adminPassword: '111111',
                adminPhone: '254712883849',
                mpesaPaybill: '222111',
                mpesaAccount: '5414200',
                maxFileSize: 10 * 1024 * 1024, // 10MB
                maxFilesPerPost: 10,
                supportWhatsApp: '254712883849',
                autoApproveSubscription: false,
                autoApproveReferrals: false,
                enableMpesaAuto: false,
                websiteUrl: window.location.origin || 'https://quickshop.onrender.com'
            }
        };
        
        // ============================================
        // INITIALIZATION
        // ============================================
        
        function initApp() {
            showSplashScreen();
            initLocalStorage();
            initMobileNavigation();
            initEventListeners();
            initChatbot();
            checkUrlParams();
            
            setTimeout(() => {
                hideSplashScreen();
            }, 2000);
        }
        
        function showSplashScreen() {
            const progress = document.getElementById('splashProgress');
            let width = 0;
            const interval = setInterval(() => {
                if (width >= 100) {
                    clearInterval(interval);
                } else {
                    width += 5;
                    progress.style.width = width + '%';
                }
            }, 50);
        }
        
        function hideSplashScreen() {
            const splash = document.getElementById('splashScreen');
            splash.classList.add('hidden');
            setTimeout(() => {
                splash.style.display = 'none';
            }, 500);
        }
        
        function initLocalStorage() {
            const keys = ['users', 'posts', 'payments', 'withdrawals', 'referrals', 'subscriptions', 'boosts', 'passwordResetTokens', 'chatMessages', 'userSettings', 'calculations', 'referralAnalytics', 'shareAnalytics'];
            keys.forEach(key => {
                AppState[key] = JSON.parse(localStorage.getItem(`qs_${key}`)) || [];
            });
            
            const sessionUser = localStorage.getItem('qs_currentUser');
            if (sessionUser) {
                const userData = JSON.parse(sessionUser);
                const user = AppState.users.find(u => u.id === userData.id);
                if (user) AppState.currentUser = user;
            }
            
            // Create admin user if doesn't exist
            if (!AppState.users.some(u => u.email === AppState.settings.adminEmail && u.role === 'admin')) {
                const adminUser = {
                    id: generateId(),
                    name: 'Admin',
                    email: AppState.settings.adminEmail,
                    phone: AppState.settings.adminPhone,
                    password: btoa(AppState.settings.adminPassword),
                    referralCode: 'ADMIN50',
                    subscription: { active: true, type: 'admin', expiresAt: '2099-12-31' },
                    role: 'admin',
                    createdAt: new Date().toISOString(),
                    profilePicture: null,
                    location: 'Nairobi',
                    bio: 'Quick Shop Administrator',
                    verified: true,
                    earnings: { balance: 0, totalEarned: 0, totalWithdrawn: 0 }
                };
                AppState.users.push(adminUser);
                saveToLocalStorage();
            }
        }
        
        function saveToLocalStorage() {
            const keys = ['users', 'posts', 'payments', 'withdrawals', 'referrals', 'subscriptions', 'boosts', 'passwordResetTokens', 'chatMessages', 'userSettings', 'calculations', 'referralAnalytics', 'shareAnalytics'];
            keys.forEach(key => {
                localStorage.setItem(`qs_${key}`, JSON.stringify(AppState[key]));
            });
            
            if (AppState.currentUser) {
                localStorage.setItem('qs_currentUser', JSON.stringify({ id: AppState.currentUser.id }));
            } else {
                localStorage.removeItem('qs_currentUser');
            }
        }
        
        // ============================================
        // NAVIGATION & UI
        // ============================================
        
        function initMobileNavigation() {
            const mobileBtn = document.getElementById('mobileMenuBtn');
            const navMenu = document.getElementById('navMenu');
            
            if (mobileBtn) {
                mobileBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    mobileBtn.classList.toggle('active');
                    navMenu.classList.toggle('active');
                });
                
                document.addEventListener('click', (e) => {
                    if (!navMenu.contains(e.target) && !mobileBtn.contains(e.target)) {
                        mobileBtn.classList.remove('active');
                        navMenu.classList.remove('active');
                    }
                });
            }
        }
        
        function initEventListeners() {
            // Form submissions
            document.getElementById('productForm')?.addEventListener('submit', function(e) {
                e.preventDefault();
                createProductPost();
            });
            
            document.getElementById('socialForm')?.addEventListener('submit', function(e) {
                e.preventDefault();
                createSocialPost();
            });
            
            document.getElementById('jobForm')?.addEventListener('submit', function(e) {
                e.preventDefault();
                createJobPost();
            });
            
            document.getElementById('withdrawalForm')?.addEventListener('submit', function(e) {
                e.preventDefault();
                requestWithdrawal();
            });
            
            document.getElementById('profileForm')?.addEventListener('submit', function(e) {
                e.preventDefault();
                updateProfile();
            });
            
            // Business tools calculators
            document.getElementById('profitCalculator')?.addEventListener('submit', function(e) {
                e.preventDefault();
                calculateProfit();
            });
            
            document.getElementById('salesTracker')?.addEventListener('submit', function(e) {
                e.preventDefault();
                calculateSales();
            });
            
            document.getElementById('roiCalculator')?.addEventListener('submit', function(e) {
                e.preventDefault();
                calculateROI();
            });
            
            // Chatbot
            document.getElementById('chatbotToggle')?.addEventListener('click', toggleChatbot);
            document.getElementById('chatbotClose')?.addEventListener('click', toggleChatbot);
            document.getElementById('chatbotInput')?.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') sendChatMessage();
            });
            
            // Marketplace filters
            document.getElementById('marketplaceSearch')?.addEventListener('input', loadMarketplace);
            document.getElementById('marketplaceCategory')?.addEventListener('change', loadMarketplace);
            document.getElementById('marketplaceSort')?.addEventListener('change', loadMarketplace);
            
            // Modal close buttons
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('modal')) {
                    closeModal(e.target.id);
                }
            });
        }
        
        function showPage(pageName) {
            const mobileBtn = document.getElementById('mobileMenuBtn');
            const navMenu = document.getElementById('navMenu');
            
            if (mobileBtn && navMenu) {
                mobileBtn.classList.remove('active');
                navMenu.classList.remove('active');
            }
            
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            updateNavigation(pageName);
            
            const page = document.getElementById(pageName);
            if (page) {
                page.classList.add('active');
                loadPageContent(pageName);
            }
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
            return false;
        }
        
        function updateNavigation(activePage) {
            const navLinks = document.getElementById('navLinks');
            const userSection = document.getElementById('userSection');
            const heroActions = document.getElementById('heroActions');
            
            if (!navLinks) return;
            
            if (AppState.currentUser) {
                const isAdmin = AppState.currentUser.role === 'admin';
                
                navLinks.innerHTML = `
                    <a href="#" class="nav-link ${activePage === 'home' ? 'active' : ''}" onclick="return showPage('home')">
                        <i class="fas fa-home"></i> <span>Home</span>
                    </a>
                    <a href="#" class="nav-link ${activePage === 'marketplace' ? 'active' : ''}" onclick="return showPage('marketplace')">
                        <i class="fas fa-store"></i> <span>Marketplace</span>
                    </a>
                    <a href="#" class="nav-link ${activePage === 'create-post' ? 'active' : ''}" onclick="return showPage('create-post')">
                        <i class="fas fa-plus-circle"></i> <span>Create Post</span>
                    </a>
                    <a href="#" class="nav-link ${activePage === 'dashboard' ? 'active' : ''}" onclick="return showPage('dashboard')">
                        <i class="fas fa-chart-line"></i> <span>Dashboard</span>
                    </a>
                    <a href="#" class="nav-link ${activePage === 'business-tools' ? 'active' : ''}" onclick="return showPage('business-tools')">
                        <i class="fas fa-calculator"></i> <span>Business Tools</span>
                    </a>
                    ${isAdmin ? `
                        <a href="#" class="nav-link ${activePage === 'admin' ? 'active' : ''}" onclick="return showPage('admin')">
                            <i class="fas fa-shield-alt"></i> <span>Admin</span>
                        </a>
                    ` : ''}
                `;
                
                userSection.innerHTML = `
                    <div class="user-avatar" onclick="return showPage('dashboard')" title="${AppState.currentUser.name}">
                        ${AppState.currentUser.name.charAt(0).toUpperCase()}
                    </div>
                    <button class="btn btn-outline" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i> <span>Logout</span>
                    </button>
                `;
                
                if (heroActions) {
                    heroActions.innerHTML = `
                        <button class="btn btn-primary" onclick="return showPage('create-post')">
                            <i class="fas fa-plus-circle"></i> Create Post
                        </button>
                        <button class="btn btn-secondary" onclick="return showPage('dashboard')">
                            <i class="fas fa-chart-line"></i> My Dashboard
                        </button>
                    `;
                }
            } else {
                navLinks.innerHTML = `
                    <a href="#" class="nav-link ${activePage === 'home' ? 'active' : ''}" onclick="return showPage('home')">
                        <i class="fas fa-home"></i> <span>Home</span>
                    </a>
                    <a href="#" class="nav-link ${activePage === 'marketplace' ? 'active' : ''}" onclick="return showPage('marketplace')">
                        <i class="fas fa-store"></i> <span>Marketplace</span>
                    </a>
                    <a href="#" class="nav-link ${activePage === 'business-tools' ? 'active' : ''}" onclick="return showPage('business-tools')">
                        <i class="fas fa-calculator"></i> <span>Business Tools</span>
                    </a>
                    <a href="#" class="nav-link ${activePage === 'register' ? 'active' : ''}" onclick="return showPage('register')">
                        <i class="fas fa-user-plus"></i> <span>Register</span>
                    </a>
                    <a href="#" class="nav-link ${activePage === 'login' ? 'active' : ''}" onclick="return showPage('login')">
                        <i class="fas fa-sign-in-alt"></i> <span>Login</span>
                    </a>
                `;
                
                userSection.innerHTML = `
                    <button class="btn btn-outline" onclick="return showPage('login')">
                        <i class="fas fa-sign-in-alt"></i> <span>Login</span>
                    </button>
                    <button class="btn btn-primary" onclick="return showPage('register')">
                        <i class="fas fa-user-plus"></i> <span>Register</span>
                    </button>
                `;
                
                if (heroActions) {
                    heroActions.innerHTML = `
                        <button class="btn btn-primary" onclick="return showPage('register')">
                            <i class="fas fa-rocket"></i> Get Started
                        </button>
                        <button class="btn btn-outline" onclick="return showPage('marketplace')">
                            <i class="fas fa-store"></i> Browse Posts
                        </button>
                    `;
                }
            }
        }
        
        function loadPageContent(pageName) {
            switch(pageName) {
                case 'home':
                    loadHomeContent();
                    break;
                case 'marketplace':
                    loadMarketplace();
                    break;
                case 'create-post':
                    loadCreatePost();
                    break;
                case 'dashboard':
                    loadDashboard();
                    break;
                case 'business-tools':
                    loadBusinessTools();
                    break;
                case 'profile':
                    loadProfile();
                    break;
                case 'admin':
                    loadAdminPanel();
                    break;
                case 'register':
                    loadRegisterForm();
                    break;
                case 'login':
                    loadLoginForm();
                    break;
                case 'forgot-password':
                    loadForgotPasswordForm();
                    break;
                case 'subscribe':
                    loadSubscriptionForm();
                    break;
            }
        }
        
        // ============================================
        // UTILITY FUNCTIONS
        // ============================================
        
        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }
        
        function generateReferralCode(name) {
            const random = Math.random().toString(36).substr(2, 6).toUpperCase();
            const initials = name.split(' ').map(n => n[0]).join('').toUpperCase();
            return initials + random;
        }
        
        function formatPrice(price) {
            return 'KES ' + price.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }
        
        function validatePhone(phone) {
            return /^2547\d{8}$/.test(phone);
        }
        
        function validateEmail(email) {
            return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
        }
        
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification`;
            notification.style.background = type === 'success' ? '#10B981' : 
                                          type === 'error' ? '#EF4444' : 
                                          type === 'warning' ? '#F59E0B' : '#3B82F6';
            
            notification.innerHTML = `
                <div style="display: flex; align-items: center; gap: 0.75rem;">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : type === 'warning' ? 'exclamation-triangle' : 'info-circle'}"></i>
                    <span>${message}</span>
                </div>
            `;
            
            const container = document.getElementById('notificationContainer');
            container.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => container.removeChild(notification), 300);
            }, 5000);
            
            if (!document.querySelector('#slideOutAnimation')) {
                const style = document.createElement('style');
                style.id = 'slideOutAnimation';
                style.textContent = `
                    @keyframes slideOut {
                        from { transform: translateX(0); opacity: 1; }
                        to { transform: translateX(100%); opacity: 0; }
                    }
                `;
                document.head.appendChild(style);
            }
        }
        
        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.remove('active');
            }
        }
        
        function formatDate(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diff = now - date;
            
            const minutes = Math.floor(diff / 60000);
            const hours = Math.floor(minutes / 60);
            const days = Math.floor(hours / 24);
            
            if (minutes < 60) return `${minutes}m ago`;
            if (hours < 24) return `${hours}h ago`;
            if (days < 7) return `${days}d ago`;
            
            return date.toLocaleDateString();
        }
        
        // ============================================
        // MEDIA UPLOAD FUNCTIONS
        // ============================================
        
        function previewMedia(inputId, previewContainerId) {
            const input = document.getElementById(inputId);
            const container = document.getElementById(previewContainerId);
            if (!input || !container) return;
            
            container.innerHTML = '';
            const files = input.files;
            
            if (files.length > AppState.settings.maxFilesPerPost) {
                showNotification(`Maximum ${AppState.settings.maxFilesPerPost} files allowed`, 'error');
                input.value = '';
                return;
            }
            
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                
                if (file.size > AppState.settings.maxFileSize) {
                    showNotification(`File ${file.name} exceeds 10MB limit`, 'error');
                    continue;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    const preview = document.createElement('div');
                    preview.className = 'media-preview';
                    
                    if (file.type.startsWith('image/')) {
                        preview.innerHTML = `
                            <img src="${e.target.result}" alt="Preview">
                            <button class="remove-media" onclick="removeMediaPreview(this, '${inputId}')">
                                <i class="fas fa-times"></i>
                            </button>
                        `;
                    } else if (file.type.startsWith('video/')) {
                        preview.innerHTML = `
                            <video controls>
                                <source src="${e.target.result}" type="${file.type}">
                                Your browser does not support the video tag.
                            </video>
                            <button class="remove-media" onclick="removeMediaPreview(this, '${inputId}')">
                                <i class="fas fa-times"></i>
                            </button>
                        `;
                    }
                    
                    container.appendChild(preview);
                };
                reader.readAsDataURL(file);
            }
        }
        
        function previewProfilePicture() {
            const input = document.getElementById('profilePicture');
            const container = document.getElementById('profilePicturePreview');
            if (!input || !container) return;
            
            const file = input.files[0];
            if (!file) return;
            
            if (!file.type.startsWith('image/')) {
                showNotification('Please select an image file', 'error');
                return;
            }
            
            if (file.size > 5 * 1024 * 1024) {
                showNotification('Image size should be less than 5MB', 'error');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                container.innerHTML = `
                    <img src="${e.target.result}" alt="Profile Preview" style="width: 150px; height: 150px; border-radius: 50%; object-fit: cover; border: 3px solid var(--primary); box-shadow: 0 4px 12px rgba(0,0,0,0.3);">
                `;
            };
            reader.readAsDataURL(file);
        }
        
        function removeMediaPreview(button, inputId) {
            const preview = button.parentElement;
            preview.remove();
            const input = document.getElementById(inputId);
            input.value = '';
        }
        
        function readFileAsBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }
        
        // ============================================
        // CHATBOT FUNCTIONS
        // ============================================
        
        function initChatbot() {
            const savedMessages = AppState.chatMessages.filter(m => 
                m.userId === (AppState.currentUser?.id || 'guest')
            );
            
            if (savedMessages.length === 0) {
                addBotMessage("Hello! I'm Quick Shop Assistant. How can I help you today?");
            } else {
                savedMessages.forEach(msg => {
                    if (msg.sender === 'bot') {
                        addBotMessage(msg.text);
                    } else {
                        addUserMessage(msg.text);
                    }
                });
            }
        }
        
        function toggleChatbot() {
            const chatbot = document.getElementById('chatbotContainer');
            chatbot.classList.toggle('active');
            
            if (chatbot.classList.contains('active')) {
                setTimeout(() => {
                    const messages = document.getElementById('chatbotMessages');
                    messages.scrollTop = messages.scrollHeight;
                }, 100);
            }
        }
        
        function addBotMessage(text) {
            const messages = document.getElementById('chatbotMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'chat-message bot';
            messageDiv.innerHTML = `
                <div class="message-bubble bot">${text}</div>
            `;
            messages.appendChild(messageDiv);
            messages.scrollTop = messages.scrollHeight;
            
            if (AppState.currentUser) {
                AppState.chatMessages.push({
                    id: generateId(),
                    userId: AppState.currentUser.id,
                    sender: 'bot',
                    text: text,
                    timestamp: new Date().toISOString()
                });
                saveToLocalStorage();
            }
        }
        
        function addUserMessage(text) {
            const messages = document.getElementById('chatbotMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'chat-message user';
            messageDiv.innerHTML = `
                <div class="message-bubble user">${text}</div>
            `;
            messages.appendChild(messageDiv);
            messages.scrollTop = messages.scrollHeight;
            
            if (AppState.currentUser) {
                AppState.chatMessages.push({
                    id: generateId(),
                    userId: AppState.currentUser.id,
                    sender: 'user',
                    text: text,
                    timestamp: new Date().toISOString()
                });
                saveToLocalStorage();
            }
        }
        
        function sendChatMessage() {
            const input = document.getElementById('chatbotInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            addUserMessage(message);
            input.value = '';
            
            setTimeout(() => {
                const response = getBotResponse(message);
                addBotMessage(response);
            }, 500);
        }
        
        function sendQuickQuestion(question) {
            addUserMessage(question);
            
            setTimeout(() => {
                const response = getBotResponse(question);
                addBotMessage(response);
            }, 500);
        }
        
        function getBotResponse(message) {
            const lowerMessage = message.toLowerCase();
            
            if (lowerMessage.includes('post') || lowerMessage.includes('create') || lowerMessage.includes('upload')) {
                return "To create a post:\n1. Click 'Create Post' in the navigation\n2. Choose Product, Social, or Job post type\n3. Fill in the details and upload images/videos\n4. Submit for posting\n\nSubscribed users can post for free!";
            } else if (lowerMessage.includes('subscribe') || lowerMessage.includes('cost') || lowerMessage.includes('price')) {
                return `Subscription is KES 50 per week. Benefits:\n Unlimited free posts\n Access to marketplace\n Earn referral commissions\n Boost post visibility\n\nPay via M-Pesa: Paybill ${AppState.settings.mpesaPaybill}, Account ${AppState.settings.mpesaAccount}\nNote: Admin approval required after payment`;
            } else if (lowerMessage.includes('earn') || lowerMessage.includes('money') || lowerMessage.includes('commission')) {
                return "Earn money on Quick Shop:\n1. Refer friends - Get 50% commission (KES 25) when they subscribe\n2. Share your referral link\n3. Withdraw earnings via M-Pesa\n\nMinimum withdrawal: KES 100";
            } else if (lowerMessage.includes('admin') || lowerMessage.includes('contact') || lowerMessage.includes('help')) {
                return `Contact admin:\n Email: ${AppState.settings.adminEmail}\n WhatsApp: ${AppState.settings.supportWhatsApp}\n Paybill: ${AppState.settings.mpesaPaybill}\n Account: ${AppState.settings.mpesaAccount}\n\nSubscriptions require admin approval within 24 hours`;
            } else if (lowerMessage.includes('password') || lowerMessage.includes('forgot') || lowerMessage.includes('reset')) {
                return `To reset password:\n1. Contact admin on WhatsApp: ${AppState.settings.supportWhatsApp}\n2. Provide your email address\n3. Admin will reset your password\n4. You'll receive new login details`;
            } else if (lowerMessage.includes('boost') || lowerMessage.includes('visibility')) {
                return "Boost your posts for KES 100 each. Benefits:\n Featured in Boosted section\n Higher search rankings\n Longer visibility\n Priority placement\n\nPay via M-Pesa with your transaction code.";
            } else if (lowerMessage.includes('marketplace') || lowerMessage.includes('browse')) {
                return "Browse marketplace:\n1. Click 'Marketplace' in navigation\n2. Filter by category (Products, Social, Jobs)\n3. Search for specific items\n4. Sort by price, date, or boosted status\n\nContact sellers via WhatsApp for inquiries.";
            } else if (lowerMessage.includes('business') || lowerMessage.includes('calculator') || lowerMessage.includes('profit')) {
                return "Business tools available:\n1. Profit Calculator - Calculate revenue, costs, profit\n2. Sales Tracker - Track monthly income\n3. ROI Calculator - Calculate return on investment\n\nGo to Dashboard  Business Tools";
            } else {
                const responses = [
                    "I'm here to help with Quick Shop questions!",
                    "You can ask me about posting, subscriptions, earnings, or contacting admin.",
                    "Check the FAQ section or contact admin for specific questions.",
                    "Is there anything else I can help you with today?"
                ];
                return responses[Math.floor(Math.random() * responses.length)];
            }
        }
        
        // ============================================
        // HOME PAGE
        // ============================================
        
        function loadHomeContent() {
            updateHomeStats();
            showHomeTab('products');
        }
        
        function updateHomeStats() {
            const visibleUsers = AppState.users.filter(u => !u.hidden && u.role !== 'admin');
            const totalPosts = AppState.posts.length;
            const totalWithdrawn = AppState.withdrawals
                .filter(w => w.status === 'approved')
                .reduce((sum, w) => sum + w.amount, 0);
            
            document.getElementById('totalUsers').textContent = visibleUsers.length;
            document.getElementById('totalPosts').textContent = totalPosts;
            document.getElementById('totalEarnings').textContent = formatPrice(totalWithdrawn);
        }
        
        function showHomeTab(tabName) {
            document.querySelectorAll('#homeContentTabs .tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.querySelectorAll('#homeContentTabs .tab-btn').forEach(btn => {
                if (btn.textContent.toLowerCase().includes(tabName)) {
                    btn.classList.add('active');
                }
            });
            
            document.querySelectorAll('.content-tab').forEach(tab => {
                tab.style.display = 'none';
            });
            
            const tab = document.getElementById(`${tabName}Tab`);
            if (tab) {
                tab.style.display = 'block';
                loadHomeTabContent(tabName);
            }
        }
        
        function loadHomeTabContent(tabName) {
            let content = [];
            const containerId = `featured${tabName.charAt(0).toUpperCase() + tabName.slice(1)}`;
            const container = document.getElementById(containerId);
            
            if (!container) return;
            
            switch(tabName) {
                case 'products':
                    content = AppState.posts
                        .filter(p => p.type === 'product' && p.status === 'active')
                        .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt))
                        .slice(0, 6);
                    container.innerHTML = content.map(createProductCard).join('');
                    break;
                    
                case 'social':
                    content = AppState.posts
                        .filter(p => p.type === 'social' && p.status === 'active')
                        .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt))
                        .slice(0, 4);
                    container.innerHTML = content.map(createSocialCard).join('');
                    break;
                    
                case 'jobs':
                    content = AppState.posts
                        .filter(p => p.type === 'job' && p.status === 'active')
                        .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt))
                        .slice(0, 6);
                    container.innerHTML = content.map(createJobCard).join('');
                    break;
                    
                case 'boosted':
                    content = AppState.posts
                        .filter(p => p.boosted === true && p.status === 'active')
                        .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt))
                        .slice(0, 6);
                    container.innerHTML = content.map(post => {
                        if (post.type === 'product') return createProductCard(post);
                        if (post.type === 'social') return createSocialCard(post);
                        if (post.type === 'job') return createJobCard(post);
                        return '';
                    }).join('');
                    break;
            }
            
            if (content.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-${tabName === 'products' ? 'box' : tabName === 'social' ? 'users' : 'briefcase'}"></i>
                        <h3 style="color: var(--white);">No ${tabName} posts yet</h3>
                        <p>Be the first to create a ${tabName} post!</p>
                    </div>
                `;
            }
        }
        
        // ============================================
        // CARD CREATION FUNCTIONS
        // ============================================
        
        function createProductCard(post) {
            const seller = AppState.users.find(u => u.id === post.userId);
            const hasMedia = post.media && post.media.length > 0;
            
            return `
                <div class="card product-card" onclick="viewPost('${post.id}')">
                    <div class="card-image">
                        ${hasMedia ? 
                            `<img src="${post.media[0]}" alt="${post.title}">` :
                            `<div style="width: 100%; height: 100%; background: linear-gradient(135deg, var(--primary), var(--secondary)); display: flex; align-items: center; justify-content: center; color: var(--dark); font-size: 3rem;">
                                <i class="fas fa-box"></i>
                            </div>`
                        }
                        ${post.boosted ? '<span class="boost-badge"><i class="fas fa-rocket"></i> BOOSTED</span>' : ''}
                    </div>
                    <div class="card-content">
                        <h3 class="card-title">${post.title}</h3>
                        <div class="card-price">${formatPrice(post.price)}</div>
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 1rem;">
                            <span style="color: var(--light-gray); font-size: 0.875rem;">
                                <i class="fas fa-map-marker-alt"></i> ${post.location}
                            </span>
                            <span style="color: var(--light-gray); font-size: 0.875rem;">
                                ${seller ? seller.name : 'User'}
                            </span>
                        </div>
                        ${hasMedia && post.media.length > 1 ? 
                            `<div style="color: var(--light-gray); font-size: 0.75rem; margin-top: 0.5rem;">
                                <i class="fas fa-images"></i> ${post.media.length} photos
                            </div>` : ''
                        }
                    </div>
                </div>
            `;
        }
        
        function createSocialCard(post) {
            const user = AppState.users.find(u => u.id === post.userId);
            const content = post.content.length > 150 ? post.content.substring(0, 150) + '...' : post.content;
            const hasMedia = post.media && post.media.length > 0;
            
            return `
                <div class="card social-card" onclick="viewPost('${post.id}')">
                    <div class="card-header">
                        ${user?.profilePicture ? 
                            `<img src="${user.profilePicture}" alt="${user.name}" style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover;">` :
                            `<div class="user-avatar-sm">
                                ${user ? user.name.charAt(0).toUpperCase() : 'U'}
                            </div>`
                        }
                        <div>
                            <div style="font-weight: 600; color: var(--white);">${user ? user.name : 'User'}</div>
                            <div style="color: var(--light-gray); font-size: 0.875rem;">
                                ${formatDate(post.createdAt)}
                            </div>
                        </div>
                    </div>
                    <div class="post-content">
                        <p>${content}</p>
                        ${hasMedia ? 
                            `<div style="margin-top: 1rem; display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.5rem;">
                                ${post.media.slice(0, 2).map(media => 
                                    `<img src="${media}" alt="Post media" style="width: 100%; height: 100px; object-fit: cover; border-radius: var(--radius);">`
                                ).join('')}
                                ${post.media.length > 2 ? 
                                    `<div style="background: var(--dark); border-radius: var(--radius); display: flex; align-items: center; justify-content: center; color: var(--light-gray);">
                                        +${post.media.length - 2} more
                                    </div>` : ''
                                }
                            </div>` : ''
                        }
                    </div>
                    <div class="post-actions">
                        <button class="post-action" onclick="event.stopPropagation(); likePost('${post.id}')">
                            <i class="far fa-heart"></i> Like
                        </button>
                        <button class="post-action" onclick="event.stopPropagation(); sharePost('${post.id}')">
                            <i class="fas fa-share"></i> Share
                        </button>
                        ${hasMedia ? 
                            `<button class="post-action" onclick="event.stopPropagation();">
                                <i class="fas fa-image"></i> ${post.media.length}
                            </button>` : ''
                        }
                    </div>
                </div>
            `;
        }
        
        function createJobCard(post) {
            const hasMedia = post.media && post.media.length > 0;
            
            return `
                <div class="card job-card" onclick="viewPost('${post.id}')">
                    <div class="card-header">
                        <span class="job-type">${post.jobType.toUpperCase()}</span>
                        <h3 class="card-title">${post.title}</h3>
                        <div style="color: var(--light-gray); font-size: 0.875rem; margin-top: 0.5rem;">
                            <i class="fas fa-building"></i> ${post.company}
                        </div>
                    </div>
                    ${hasMedia ? 
                        `<div style="padding: 1rem 1.5rem 0;">
                            <div style="width: 100%; height: 100px; background: linear-gradient(135deg, var(--primary), var(--secondary)); border-radius: var(--radius); overflow: hidden;">
                                <img src="${post.media[0]}" alt="Company" style="width: 100%; height: 100%; object-fit: cover;">
                            </div>
                        </div>` : ''
                    }
                    <div class="card-content">
                        <p style="color: var(--light-gray); margin-bottom: 1rem;">
                            ${post.description.length > 100 ? post.description.substring(0, 100) + '...' : post.description}
                        </p>
                        <div class="job-salary">
                            ${formatPrice(post.salaryMin)} - ${formatPrice(post.salaryMax)}
                        </div>
                        <div style="color: var(--light-gray); font-size: 0.875rem;">
                            <i class="fas fa-map-marker-alt"></i> ${post.location}
                        </div>
                    </div>
                </div>
            `;
        }
        
        // ============================================
        // POST MANAGEMENT
        // ============================================
        
        function showPostForm(formType) {
            document.querySelectorAll('.post-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.querySelectorAll('.post-tab').forEach(tab => {
                if (tab.textContent.toLowerCase().includes(formType)) {
                    tab.classList.add('active');
                }
            });
            
            document.querySelectorAll('.post-form').forEach(form => {
                form.classList.remove('active');
            });
            
            const form = document.getElementById(`${formType}Form`);
            if (form) {
                form.classList.add('active');
            }
        }
        
        function loadCreatePost() {
            if (!AppState.currentUser) {
                showNotification('Please login to create posts', 'error');
                showPage('login');
                return;
            }
            
            if (!AppState.currentUser.subscription?.active) {
                showNotification('Active subscription required to post', 'error');
                showPage('subscribe');
                return;
            }
            
            document.querySelectorAll('.post-form').forEach(form => {
                form.reset();
                const previews = form.querySelectorAll('.media-preview-container');
                previews.forEach(preview => preview.innerHTML = '');
            });
            
            showPostForm('product');
        }
        
        async function createProductPost() {
            if (!AppState.currentUser) return;
            
            const title = document.getElementById('productTitle').value;
            const description = document.getElementById('productDescription').value;
            const price = parseInt(document.getElementById('productPrice').value);
            const category = document.getElementById('productCategory').value;
            const location = document.getElementById('productLocation').value;
            const whatsapp = document.getElementById('productWhatsapp').value;
            const boosted = document.getElementById('boostProduct').checked;
            const mediaFiles = document.getElementById('productMedia').files;
            
            if (!validatePhone(whatsapp)) {
                showNotification('Invalid WhatsApp number. Use format: 2547XXXXXXXX', 'error');
                return;
            }
            
            const media = [];
            if (mediaFiles.length > 0) {
                for (let i = 0; i < Math.min(mediaFiles.length, AppState.settings.maxFilesPerPost); i++) {
                    const file = mediaFiles[i];
                    if (file.size <= AppState.settings.maxFileSize) {
                        try {
                            const base64 = await readFileAsBase64(file);
                            media.push(base64);
                        } catch (error) {
                            console.error('Error reading file:', error);
                        }
                    }
                }
            }
            
            const post = {
                id: generateId(),
                type: 'product',
                title: title,
                description: description,
                price: price,
                category: category,
                location: location,
                whatsapp: whatsapp,
                media: media,
                boosted: boosted,
                userId: AppState.currentUser.id,
                status: 'active',
                createdAt: new Date().toISOString(),
                views: 0,
                likes: 0
            };
            
            AppState.posts.push(post);
            
            if (post.boosted) {
                showBoostModal(post.id);
            } else {
                saveToLocalStorage();
                showNotification('Product posted successfully!', 'success');
                showPage('dashboard');
            }
        }
        
        async function createSocialPost() {
            if (!AppState.currentUser) return;
            
            const content = document.getElementById('socialContent').value;
            const boosted = document.getElementById('boostSocial').checked;
            const mediaFiles = document.getElementById('socialMedia').files;
            
            const media = [];
            if (mediaFiles.length > 0) {
                for (let i = 0; i < Math.min(mediaFiles.length, AppState.settings.maxFilesPerPost); i++) {
                    const file = mediaFiles[i];
                    if (file.size <= AppState.settings.maxFileSize) {
                        try {
                            const base64 = await readFileAsBase64(file);
                            media.push(base64);
                        } catch (error) {
                            console.error('Error reading file:', error);
                        }
                    }
                }
            }
            
            const post = {
                id: generateId(),
                type: 'social',
                content: content,
                media: media,
                boosted: boosted,
                userId: AppState.currentUser.id,
                status: 'active',
                createdAt: new Date().toISOString(),
                likes: 0,
                comments: []
            };
            
            AppState.posts.push(post);
            
            if (post.boosted) {
                showBoostModal(post.id);
            } else {
                saveToLocalStorage();
                showNotification('Social post shared!', 'success');
                showPage('dashboard');
            }
        }
        
        async function createJobPost() {
            if (!AppState.currentUser) return;
            
            const title = document.getElementById('jobTitle').value;
            const company = document.getElementById('jobCompany').value;
            const description = document.getElementById('jobDescription').value;
            const jobType = document.getElementById('jobType').value;
            const salaryMin = parseInt(document.getElementById('jobSalaryMin').value);
            const salaryMax = parseInt(document.getElementById('jobSalaryMax').value);
            const location = document.getElementById('jobLocation').value;
            const whatsapp = document.getElementById('jobWhatsapp').value;
            const apply = document.getElementById('jobApply').value;
            const boosted = document.getElementById('boostJob').checked;
            const mediaFiles = document.getElementById('jobMedia').files;
            
            if (!validatePhone(whatsapp)) {
                showNotification('Invalid WhatsApp number. Use format: 2547XXXXXXXX', 'error');
                return;
            }
            
            const media = [];
            if (mediaFiles.length > 0) {
                for (let i = 0; i < Math.min(mediaFiles.length, 5); i++) {
                    const file = mediaFiles[i];
                    if (file.size <= AppState.settings.maxFileSize) {
                        try {
                            const base64 = await readFileAsBase64(file);
                            media.push(base64);
                        } catch (error) {
                            console.error('Error reading file:', error);
                        }
                    }
                }
            }
            
            const post = {
                id: generateId(),
                type: 'job',
                title: title,
                company: company,
                description: description,
                jobType: jobType,
                salaryMin: salaryMin,
                salaryMax: salaryMax,
                location: location,
                whatsapp: whatsapp,
                apply: apply,
                media: media,
                boosted: boosted,
                userId: AppState.currentUser.id,
                status: 'active',
                createdAt: new Date().toISOString(),
                views: 0
            };
            
            AppState.posts.push(post);
            
            if (post.boosted) {
                showBoostModal(post.id);
            } else {
                saveToLocalStorage();
                showNotification('Job posted successfully!', 'success');
                showPage('dashboard');
            }
        }
        
        function showBoostModal(postId) {
            const modal = document.getElementById('paymentModal');
            const post = AppState.posts.find(p => p.id === postId);
            if (!post) return;
            
            modal.innerHTML = `
                <div class="modal-content">
                    <button class="modal-close" onclick="closeModal('paymentModal')">&times;</button>
                    <div style="padding: 2rem;">
                        <div style="text-align: center; margin-bottom: 2rem;">
                            <div style="width: 80px; height: 80px; background: linear-gradient(135deg, var(--secondary), var(--secondary-dark)); 
                                 border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem;">
                                <i class="fas fa-rocket" style="font-size: 2rem; color: var(--dark);"></i>
                            </div>
                            <h3>Boost Your Post</h3>
                            <p style="color: var(--light-gray);">KES 100 for increased visibility</p>
                        </div>
                        
                        <div style="background: var(--dark); padding: 1.5rem; border-radius: var(--radius); margin-bottom: 2rem;">
                            <h4 style="margin-bottom: 0.5rem;">Post Details</h4>
                            <p><strong>Type:</strong> ${post.type.charAt(0).toUpperCase() + post.type.slice(1)}</p>
                            <p><strong>Title:</strong> ${post.title || 'Social Post'}</p>
                            <p><strong>Boost Benefits:</strong></p>
                            <ul style="padding-left: 1.5rem; margin-top: 0.5rem;">
                                <li>Featured in Boosted section</li>
                                <li>Higher search rankings</li>
                                <li>Longer visibility duration</li>
                                <li>Priority placement</li>
                                <li>7 days boosted visibility</li>
                            </ul>
                        </div>
                        
                        <div class="payment-steps">
                            <div style="display: flex; align-items: flex-start; gap: 1rem; margin-bottom: 1.5rem;">
                                <div style="width: 30px; height: 30px; background: var(--primary); color: var(--secondary); 
                                     border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600;">
                                    1
                                </div>
                                <div>
                                    <strong>Pay KES 100 via M-Pesa</strong>
                                    <p style="color: var(--light-gray); font-size: 0.875rem; margin-top: 0.25rem;">
                                        Paybill: ${AppState.settings.mpesaPaybill}<br>
                                        Account: ${AppState.settings.mpesaAccount}
                                    </p>
                                </div>
                            </div>
                            
                            <div style="display: flex; align-items: flex-start; gap: 1rem; margin-bottom: 1.5rem;">
                                <div style="width: 30px; height: 30px; background: var(--primary); color: var(--secondary); 
                                     border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600;">
                                    2
                                </div>
                                <div>
                                    <strong>Enter Transaction Code</strong>
                                    <p style="color: var(--light-gray); font-size: 0.875rem; margin-top: 0.25rem;">
                                        Enter M-Pesa confirmation code
                                    </p>
                                </div>
                            </div>
                        </div>
                        
                        <form onsubmit="processBoostPayment('${postId}'); return false;">
                            <div class="form-group">
                                <input type="text" class="form-control" id="boostTransactionCode" 
                                       placeholder="Transaction Code" required>
                            </div>
                            <button type="submit" class="btn btn-secondary w-full">
                                <i class="fas fa-paper-plane"></i> Submit for Approval
                            </button>
                        </form>
                        
                        <button class="btn btn-outline w-full mt-2" onclick="postWithoutBoost('${postId}')">
                            Skip Boost (Post Anyway)
                        </button>
                    </div>
                </div>
            `;
            
            modal.classList.add('active');
        }
        
        function postWithoutBoost(postId) {
            const post = AppState.posts.find(p => p.id === postId);
            if (post) {
                post.boosted = false;
            }
            saveToLocalStorage();
            closeModal('paymentModal');
            showNotification('Post created without boost', 'success');
            showPage('dashboard');
        }
        
        function processBoostPayment(postId) {
            const transactionCode = document.getElementById('boostTransactionCode').value;
            if (!transactionCode) {
                showNotification('Please enter transaction code', 'error');
                return;
            }
            
            const boost = {
                id: generateId(),
                postId: postId,
                userId: AppState.currentUser.id,
                amount: AppState.settings.boostPrice,
                transactionCode: transactionCode,
                status: 'pending',
                createdAt: new Date().toISOString(),
                boostExpires: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString()
            };
            
            AppState.boosts.push(boost);
            saveToLocalStorage();
            closeModal('paymentModal');
            
            showNotification('Boost request submitted for admin approval', 'success');
            showPage('dashboard');
        }
        
        // ============================================
        // NEW: BUSINESS TOOLS FUNCTIONS
        // ============================================
        
        function loadBusinessTools() {
            if (!AppState.currentUser) {
                showNotification('Please login to access business tools', 'error');
                showPage('login');
                return;
            }
            
            loadCalculationHistory();
        }
        
        function calculateProfit() {
            const revenue = parseFloat(document.getElementById('revenue').value) || 0;
            const costs = parseFloat(document.getElementById('costs').value) || 0;
            
            if (revenue <= 0) {
                showNotification('Please enter revenue amount', 'error');
                return;
            }
            
            const profit = revenue - costs;
            const margin = costs > 0 ? ((profit / revenue) * 100).toFixed(2) : 100;
            
            document.getElementById('resultRevenue').textContent = formatPrice(revenue);
            document.getElementById('resultCosts').textContent = formatPrice(costs);
            document.getElementById('resultProfit').textContent = formatPrice(profit);
            document.getElementById('resultMargin').textContent = `${margin}%`;
            
            document.getElementById('profitResult').style.display = 'block';
        }
        
        function calculateSales() {
            const productSales = parseFloat(document.getElementById('productSales').value) || 0;
            const otherIncome = parseFloat(document.getElementById('otherIncome').value) || 0;
            const operatingCosts = parseFloat(document.getElementById('operatingCosts').value) || 0;
            
            const totalIncome = productSales + otherIncome;
            const netIncome = totalIncome - operatingCosts;
            const growth = operatingCosts > 0 ? ((netIncome / operatingCosts) * 100).toFixed(2) : 0;
            
            document.getElementById('totalIncome').textContent = formatPrice(totalIncome);
            document.getElementById('totalCosts').textContent = formatPrice(operatingCosts);
            document.getElementById('netIncome').textContent = formatPrice(netIncome);
            document.getElementById('monthlyGrowth').textContent = `${growth}%`;
            
            document.getElementById('salesResult').style.display = 'block';
        }
        
        function calculateROI() {
            const investment = parseFloat(document.getElementById('investment').value) || 0;
            const returnAmount = parseFloat(document.getElementById('returnAmount').value) || 0;
            
            if (investment <= 0) {
                showNotification('Please enter investment amount', 'error');
                return;
            }
            
            const netGain = returnAmount - investment;
            const roiPercentage = investment > 0 ? ((netGain / investment) * 100).toFixed(2) : 0;
            
            document.getElementById('roiInvestment').textContent = formatPrice(investment);
            document.getElementById('roiReturn').textContent = formatPrice(returnAmount);
            document.getElementById('netGain').textContent = formatPrice(netGain);
            document.getElementById('roiPercentage').textContent = `${roiPercentage}%`;
            
            document.getElementById('roiResult').style.display = 'block';
        }
        
        function saveProfitCalculation() {
            const revenue = parseFloat(document.getElementById('revenue').value) || 0;
            const costs = parseFloat(document.getElementById('costs').value) || 0;
            const profit = revenue - costs;
            const margin = costs > 0 ? ((profit / revenue) * 100).toFixed(2) : 100;
            
            const calculation = {
                id: generateId(),
                userId: AppState.currentUser.id,
                type: 'profit',
                revenue: revenue,
                costs: costs,
                profit: profit,
                margin: margin,
                createdAt: new Date().toISOString()
            };
            
            AppState.calculations.push(calculation);
            saveToLocalStorage();
            loadCalculationHistory();
            showNotification('Calculation saved successfully', 'success');
        }
        
        function loadCalculationHistory() {
            const container = document.getElementById('calculationHistory');
            if (!container) return;
            
            const userCalculations = AppState.calculations
                .filter(c => c.userId === AppState.currentUser.id)
                .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt))
                .slice(0, 10);
            
            if (userCalculations.length === 0) {
                container.innerHTML = `<p style="color: var(--light-gray); text-align: center; padding: 2rem;">No calculations saved yet</p>`;
                return;
            }
            
            let html = '';
            userCalculations.forEach(calc => {
                if (calc.type === 'profit') {
                    html += `
                        <div class="history-item">
                            <div>
                                <div style="font-weight: 600; color: var(--white);">Profit Calculation</div>
                                <div style="color: var(--light-gray); font-size: 0.875rem;">
                                    Profit: ${formatPrice(calc.profit)} | Margin: ${calc.margin}%
                                </div>
                            </div>
                            <div style="color: var(--light-gray); font-size: 0.75rem;">
                                ${formatDate(calc.createdAt)}
                            </div>
                        </div>
                    `;
                }
            });
            
            container.innerHTML = html;
        }
        
        function clearCalculationHistory() {
            if (!confirm('Clear all calculation history?')) return;
            
            AppState.calculations = AppState.calculations.filter(c => c.userId !== AppState.currentUser.id);
            saveToLocalStorage();
            loadCalculationHistory();
            showNotification('Calculation history cleared', 'success');
        }
        
        function exportCalculations() {
            const userCalculations = AppState.calculations.filter(c => c.userId === AppState.currentUser.id);
            
            if (userCalculations.length === 0) {
                showNotification('No calculations to export', 'error');
                return;
            }
            
            let csv = 'Type,Revenue,Costs,Profit,Margin%,Date\n';
            userCalculations.forEach(calc => {
                csv += `${calc.type},${calc.revenue},${calc.costs},${calc.profit},${calc.margin},${calc.createdAt}\n`;
            });
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `quick-shop-calculations-${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
            
            showNotification('Calculations exported as CSV', 'success');
        }
        
        // ============================================
        // DASHBOARD & PROFILE
        // ============================================
        
        function loadDashboard() {
            if (!AppState.currentUser) {
                showNotification('Please login to view dashboard', 'error');
                showPage('login');
                return;
            }
            
            updateDashboardStats();
            showDashboardTab('myProducts');
            updateReferralLink();
            loadProfileHeader();
            updateReferralAnalytics();
        }
        
        function updateReferralAnalytics() {
            if (!AppState.currentUser) return;
            
            const userAnalytics = AppState.referralAnalytics.filter(a => a.referrerId === AppState.currentUser.id);
            const views = userAnalytics.filter(a => a.type === 'view').length;
            const clicks = userAnalytics.filter(a => a.type === 'click').length;
            const signups = AppState.referrals.filter(r => r.referrerId === AppState.currentUser.id && r.status === 'approved').length;
            
            document.getElementById('referralViews').textContent = views;
            document.getElementById('referralClicks').textContent = clicks;
            document.getElementById('referralSignups').textContent = signups;
        }
        
        function loadProfileHeader() {
            const user = AppState.currentUser;
            if (!user) return;
            
            document.getElementById('profileAvatar').innerHTML = user.profilePicture ? 
                `<img src="${user.profilePicture}" alt="${user.name}" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">` :
                user.name.charAt(0).toUpperCase();
            
            document.getElementById('profileName').textContent = user.name;
            document.getElementById('profileEmail').textContent = user.email;
            document.getElementById('profilePhone').textContent = user.phone;
            
            const status = document.getElementById('profileStatus');
            if (user.subscription?.active) {
                const expiresAt = new Date(user.subscription.expiresAt);
                const daysLeft = Math.ceil((expiresAt - new Date()) / (1000 * 60 * 60 * 24));
                if (daysLeft <= 0) {
                    user.subscription.active = false;
                    saveToLocalStorage();
                    status.innerHTML = '<span class="badge badge-warning">Subscription Expired</span>';
                } else {
                    status.innerHTML = `<span class="badge badge-success">Subscribed (${daysLeft} days left)</span>`;
                }
            } else {
                status.innerHTML = '<span class="badge badge-warning">Not Subscribed</span>';
            }
        }
        
        function updateDashboardStats() {
            const userId = AppState.currentUser.id;
            
            const myProducts = AppState.posts.filter(p => p.userId === userId && p.type === 'product');
            const mySocial = AppState.posts.filter(p => p.userId === userId && p.type === 'social');
            const myJobs = AppState.posts.filter(p => p.userId === userId && p.type === 'job');
            
            const userReferrals = AppState.referrals.filter(r => r.referrerId === userId && r.status === 'approved');
            const totalEarned = userReferrals.reduce((sum, r) => sum + r.commission, 0);
            const totalWithdrawn = AppState.withdrawals
                .filter(w => w.userId === userId && w.status === 'approved')
                .reduce((sum, w) => sum + w.amount, 0);
            
            document.getElementById('myProductsCount').textContent = myProducts.length;
            document.getElementById('mySocialPosts').textContent = mySocial.length;
            document.getElementById('myJobsCount').textContent = myJobs.length;
            document.getElementById('myEarnings').textContent = formatPrice(totalEarned);
            document.getElementById('totalReferrals').textContent = userReferrals.length;
            document.getElementById('earnedAmount').textContent = formatPrice(totalEarned);
            document.getElementById('withdrawnAmount').textContent = formatPrice(totalWithdrawn);
        }
        
        function showDashboardTab(tabName) {
            document.querySelectorAll('.dashboard-tab').forEach(tab => {
                tab.style.display = 'none';
            });
            document.querySelectorAll('#dashboard .tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.querySelectorAll('#dashboard .tab-btn').forEach(btn => {
                if (btn.textContent.toLowerCase().includes(tabName.replace('my', ''))) {
                    btn.classList.add('active');
                }
            });
            
            const tab = document.getElementById(`${tabName}Tab`);
            if (tab) {
                tab.style.display = 'block';
                loadDashboardTabContent(tabName);
            }
        }
        
        function loadDashboardTabContent(tabName) {
            const userId = AppState.currentUser.id;
            let content = [];
            let container = null;
            let createCard = null;
            
            switch(tabName) {
                case 'myProducts':
                    content = AppState.posts.filter(p => p.userId === userId && p.type === 'product');
                    container = document.getElementById('myProductsGrid');
                    createCard = createProductCard;
                    break;
                    
                case 'mySocial':
                    content = AppState.posts.filter(p => p.userId === userId && p.type === 'social');
                    container = document.getElementById('mySocialGrid');
                    createCard = createSocialCard;
                    break;
                    
                case 'myJobs':
                    content = AppState.posts.filter(p => p.userId === userId && p.type === 'job');
                    container = document.getElementById('myJobsGrid');
                    createCard = createJobCard;
                    break;
                    
                case 'myBoosted':
                    content = AppState.posts.filter(p => p.userId === userId && p.boosted === true);
                    container = document.getElementById('myBoostedGrid');
                    createCard = (post) => {
                        if (post.type === 'product') return createProductCard(post);
                        if (post.type === 'social') return createSocialCard(post);
                        if (post.type === 'job') return createJobCard(post);
                        return '';
                    };
                    break;
            }
            
            if (!container) return;
            
            if (content.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-${tabName === 'myProducts' ? 'box' : tabName === 'mySocial' ? 'users' : tabName === 'myJobs' ? 'briefcase' : 'rocket'}"></i>
                        <h3 style="color: var(--white);">No ${tabName.replace('my', '').toLowerCase()} posts</h3>
                        <p>Create your first ${tabName.replace('my', '').toLowerCase()} post!</p>
                    </div>
                `;
            } else {
                container.innerHTML = content.map(createCard).join('');
            }
        }
        
        function loadProfile() {
            if (!AppState.currentUser) {
                showNotification('Please login to edit profile', 'error');
                showPage('login');
                return;
            }
            
            const user = AppState.currentUser;
            
            document.getElementById('profileNameInput').value = user.name;
            document.getElementById('profileEmailInput').value = user.email;
            document.getElementById('profilePhoneInput').value = user.phone;
            document.getElementById('profileLocation').value = user.location || '';
            document.getElementById('profileBio').value = user.bio || '';
            
            const preview = document.getElementById('profilePicturePreview');
            if (user.profilePicture) {
                preview.innerHTML = `
                    <img src="${user.profilePicture}" alt="Profile" style="width: 150px; height: 150px; border-radius: 50%; object-fit: cover; border: 3px solid var(--primary); box-shadow: 0 4px 12px rgba(0,0,0,0.3);">
                `;
            }
        }
        
        async function updateProfile() {
            const user = AppState.currentUser;
            if (!user) return;
            
            const name = document.getElementById('profileNameInput').value;
            const email = document.getElementById('profileEmailInput').value;
            const phone = document.getElementById('profilePhoneInput').value;
            const location = document.getElementById('profileLocation').value;
            const bio = document.getElementById('profileBio').value;
            const currentPassword = document.getElementById('profileCurrentPassword').value;
            const newPassword = document.getElementById('profileNewPassword').value;
            const confirmPassword = document.getElementById('profileConfirmPassword').value;
            const profilePictureFile = document.getElementById('profilePicture').files[0];
            
            const emailExists = AppState.users.some(u => 
                u.email === email && u.id !== user.id && !u.hidden
            );
            
            if (emailExists) {
                showNotification('Email already taken', 'error');
                return;
            }
            
            if (!validateEmail(email)) {
                showNotification('Invalid email address', 'error');
                return;
            }
            
            if (!validatePhone(phone)) {
                showNotification('Invalid phone number (use format: 2547XXXXXXXX)', 'error');
                return;
            }
            
            if (profilePictureFile) {
                if (profilePictureFile.size > 5 * 1024 * 1024) {
                    showNotification('Profile picture should be less than 5MB', 'error');
                    return;
                }
                
                try {
                    const base64 = await readFileAsBase64(profilePictureFile);
                    user.profilePicture = base64;
                } catch (error) {
                    console.error('Error reading profile picture:', error);
                }
            }
            
            if (currentPassword && newPassword && confirmPassword) {
                if (atob(user.password) !== currentPassword) {
                    showNotification('Current password is incorrect', 'error');
                    return;
                }
                
                if (newPassword !== confirmPassword) {
                    showNotification('New passwords do not match', 'error');
                    return;
                }
                
                if (newPassword.length < 6) {
                    showNotification('Password must be at least 6 characters', 'error');
                    return;
                }
                
                user.password = btoa(newPassword);
            }
            
            user.name = name;
            user.email = email;
            user.phone = phone;
            user.location = location;
            user.bio = bio;
            
            saveToLocalStorage();
            
            document.getElementById('profileCurrentPassword').value = '';
            document.getElementById('profileNewPassword').value = '';
            document.getElementById('profileConfirmPassword').value = '';
            
            showNotification('Profile updated successfully!', 'success');
            showPage('dashboard');
        }
        
        function updateReferralLink() {
            if (!AppState.currentUser) return;
            
            const link = `${AppState.settings.websiteUrl}?ref=${AppState.currentUser.referralCode}`;
            const input = document.getElementById('referralLink');
            if (input) {
                input.value = link;
            }
        }
        
        function copyReferralLink() {
            const input = document.getElementById('referralLink');
            if (!input) return;
            
            input.select();
            input.setSelectionRange(0, 99999);
            
            navigator.clipboard.writeText(input.value).then(() => {
                showNotification('Referral link copied to clipboard!', 'success');
                
                trackReferralAnalytics('click');
            }).catch(() => {
                document.execCommand('copy');
                showNotification('Link copied!', 'success');
                trackReferralAnalytics('click');
            });
        }
        
        function shareReferralLink() {
            const user = AppState.currentUser;
            if (!user) return;
            
            const link = `${AppState.settings.websiteUrl}?ref=${user.referralCode}`;
            const text = `Join me on QUICK SHOP! Use my referral link to sign up and get started: ${link}`;
            
            showShareModal(null, text, link, 'referral');
        }
        
        function trackReferralAnalytics(type) {
            if (!AppState.currentUser) return;
            
            const analytics = {
                id: generateId(),
                referrerId: AppState.currentUser.id,
                type: type,
                timestamp: new Date().toISOString()
            };
            
            AppState.referralAnalytics.push(analytics);
            saveToLocalStorage();
        }
        
        function requestWithdrawal() {
            if (!AppState.currentUser) return;
            
            const amount = parseFloat(document.getElementById('withdrawalAmount').value);
            const mpesa = document.getElementById('withdrawalMpesa').value;
            
            if (amount < 100) {
                showNotification('Minimum withdrawal is KES 100', 'error');
                return;
            }
            
            if (!validatePhone(mpesa)) {
                showNotification('Invalid M-Pesa number', 'error');
                return;
            }
            
            const user = AppState.currentUser;
            const userReferrals = AppState.referrals.filter(r => r.referrerId === user.id && r.status === 'approved');
            const totalEarned = userReferrals.reduce((sum, r) => sum + r.commission, 0);
            const totalWithdrawn = AppState.withdrawals
                .filter(w => w.userId === user.id && w.status === 'approved')
                .reduce((sum, w) => sum + w.amount, 0);
            const available = totalEarned - totalWithdrawn;
            
            if (amount > available) {
                showNotification('Insufficient balance', 'error');
                return;
            }
            
            const withdrawal = {
                id: generateId(),
                userId: user.id,
                amount: amount,
                mpesaNumber: mpesa,
                status: 'pending',
                createdAt: new Date().toISOString()
            };
            
            AppState.withdrawals.push(withdrawal);
            saveToLocalStorage();
            
            document.getElementById('withdrawalForm').reset();
            showNotification(`Withdrawal request submitted for ${formatPrice(amount)}. Admin will process within 24 hours.`, 'success');
            loadDashboard();
        }
        
        // ============================================
        // NEW: SHARE FUNCTIONS
        // ============================================
        
        function sharePost(postId) {
            const post = AppState.posts.find(p => p.id === postId);
            if (!post) return;
            
            const url = `${AppState.settings.websiteUrl}?post=${postId}`;
            const text = `Check out this ${post.type} on QUICK SHOP: ${post.title || 'Social Post'}`;
            
            showShareModal(post, text, url, 'post');
            
            trackShareAnalytics(postId, 'click');
        }
        
        function showShareModal(post, text, url, shareType = 'post') {
            const modal = document.getElementById('shareModal');
            
            modal.innerHTML = `
                <div class="modal-content">
                    <button class="modal-close" onclick="closeModal('shareModal')">&times;</button>
                    <div style="padding: 2rem;">
                        <h3 style="margin-bottom: 1.5rem; color: var(--white);">
                            <i class="fas fa-share-alt"></i> Share ${shareType === 'referral' ? 'Referral Link' : 'Post'}
                        </h3>
                        
                        <div style="background: var(--dark); padding: 1.5rem; border-radius: var(--radius); margin-bottom: 1.5rem;">
                            <p style="color: var(--light-gray); margin-bottom: 1rem;">${text}</p>
                            <div style="display: flex; gap: 1rem;">
                                <input type="text" class="form-control" id="shareUrl" value="${url}" readonly style="flex: 1;">
                                <button class="btn btn-secondary" onclick="copyShareUrl()">
                                    <i class="fas fa-copy"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div class="share-options">
                            <div class="share-option facebook" onclick="shareOnFacebook('${url}', '${text}')">
                                <i class="fab fa-facebook"></i>
                                <span>Facebook</span>
                            </div>
                            
                            <div class="share-option twitter" onclick="shareOnTwitter('${url}', '${text}')">
                                <i class="fab fa-twitter"></i>
                                <span>Twitter</span>
                            </div>
                            
                            <div class="share-option whatsapp" onclick="shareOnWhatsApp('${url}', '${text}')">
                                <i class="fab fa-whatsapp"></i>
                                <span>WhatsApp</span>
                            </div>
                            
                            <div class="share-option copy" onclick="copyShareUrl()">
                                <i class="fas fa-copy"></i>
                                <span>Copy Link</span>
                            </div>
                        </div>
                        
                        ${shareType === 'post' && post ? `
                            <div class="referral-analytics">
                                <h4 style="color: var(--white); margin-bottom: 1rem;">Share Analytics</h4>
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 1rem;">
                                    <div style="text-align: center;">
                                        <div style="font-size: 1.5rem; font-weight: 800; color: var(--secondary);">${post.views || 0}</div>
                                        <div style="font-size: 0.875rem; color: var(--light-gray);">Views</div>
                                    </div>
                                    <div style="text-align: center;">
                                        <div style="font-size: 1.5rem; font-weight: 800; color: var(--secondary);">${post.likes || 0}</div>
                                        <div style="font-size: 0.875rem; color: var(--light-gray);">Likes</div>
                                    </div>
                                    <div style="text-align: center;">
                                        <div style="font-size: 1.5rem; font-weight: 800; color: var(--secondary);" id="shareCount">0</div>
                                        <div style="font-size: 0.875rem; color: var(--light-gray);">Shares</div>
                                    </div>
                                </div>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;
            
            if (shareType === 'post' && post) {
                const shareCount = AppState.shareAnalytics.filter(s => s.postId === post.id).length;
                document.getElementById('shareCount').textContent = shareCount;
            }
            
            modal.classList.add('active');
        }
        
        function copyShareUrl() {
            const input = document.getElementById('shareUrl');
            if (!input) return;
            
            input.select();
            input.setSelectionRange(0, 99999);
            
            navigator.clipboard.writeText(input.value).then(() => {
                showNotification('Link copied to clipboard!', 'success');
            });
        }
        
        function shareOnFacebook(url, text) {
            const shareUrl = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}&quote=${encodeURIComponent(text)}`;
            window.open(shareUrl, '_blank', 'width=600,height=400');
            trackShareAnalytics(url.includes('post=') ? url.split('post=')[1] : null, 'facebook');
        }
        
        function shareOnTwitter(url, text) {
            const shareUrl = `https://twitter.com/intent/tweet?url=${encodeURIComponent(url)}&text=${encodeURIComponent(text)}`;
            window.open(shareUrl, '_blank', 'width=600,height=400');
            trackShareAnalytics(url.includes('post=') ? url.split('post=')[1] : null, 'twitter');
        }
        
        function shareOnWhatsApp(url, text) {
            const shareUrl = `https://wa.me/?text=${encodeURIComponent(text + ' ' + url)}`;
            window.open(shareUrl, '_blank');
            trackShareAnalytics(url.includes('post=') ? url.split('post=')[1] : null, 'whatsapp');
        }
        
        function trackShareAnalytics(postId, platform) {
            if (!postId) return;
            
            const analytics = {
                id: generateId(),
                postId: postId,
                platform: platform,
                timestamp: new Date().toISOString()
            };
            
            AppState.shareAnalytics.push(analytics);
            saveToLocalStorage();
        }
        
        // ============================================
        // MARKETPLACE
        // ============================================
        
        function loadMarketplace() {
            const searchInput = document.getElementById('marketplaceSearch');
            const categorySelect = document.getElementById('marketplaceCategory');
            const sortSelect = document.getElementById('marketplaceSort');
            const container = document.getElementById('marketplaceContent');
            
            if (!container) return;
            
            let posts = [...AppState.posts].filter(p => p.status === 'active');
            
            const searchTerm = searchInput?.value.toLowerCase() || '';
            const category = categorySelect?.value || '';
            const sortBy = sortSelect?.value || 'newest';
            
            if (searchTerm) {
                posts = posts.filter(p => 
                    (p.title || '').toLowerCase().includes(searchTerm) ||
                    (p.description || '').toLowerCase().includes(searchTerm) ||
                    (p.content || '').toLowerCase().includes(searchTerm) ||
                    (p.company || '').toLowerCase().includes(searchTerm) ||
                    (p.category || '').toLowerCase().includes(searchTerm)
                );
            }
            
            if (category) {
                posts = posts.filter(p => p.type === category);
            }
            
            switch(sortBy) {
                case 'newest':
                    posts.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
                    break;
                case 'oldest':
                    posts.sort((a, b) => new Date(a.createdAt) - new Date(b.createdAt));
                    break;
                case 'price-low':
                    posts.sort((a, b) => (a.price || 0) - (b.price || 0));
                    break;
                case 'price-high':
                    posts.sort((a, b) => (b.price || 0) - (a.price || 0));
                    break;
                case 'boosted':
                    posts.sort((a, b) => (b.boosted ? 1 : 0) - (a.boosted ? 1 : 0));
                    break;
            }
            
            if (posts.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-search"></i>
                        <h3 style="color: var(--white);">No posts found</h3>
                        <p>Try different search terms or create a post!</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = posts.map(post => {
                if (post.type === 'product') return createProductCard(post);
                if (post.type === 'social') return createSocialCard(post);
                if (post.type === 'job') return createJobCard(post);
                return '';
            }).join('');
        }
        
        // ============================================
        // VIEW POST
        // ============================================
        
        function viewPost(postId) {
            const post = AppState.posts.find(p => p.id === postId);
            if (!post) return;
            
            const user = AppState.users.find(u => u.id === post.userId);
            const modal = document.getElementById('postModal');
            
            post.views = (post.views || 0) + 1;
            saveToLocalStorage();
            
            let content = '';
            
            switch(post.type) {
                case 'product':
                    content = `
                        <div class="modal-content">
                            <button class="modal-close" onclick="closeModal('postModal')">&times;</button>
                            <div style="padding: 2rem;">
                                <h3 style="margin-bottom: 1.5rem; color: var(--white);">${post.title}</h3>
                                
                                ${post.media && post.media.length > 0 ? 
                                    `<div style="position: relative; margin-bottom: 1.5rem;">
                                        <div style="width: 100%; height: 300px; border-radius: var(--radius); overflow: hidden;">
                                            <img src="${post.media[0]}" alt="${post.title}" style="width: 100%; height: 100%; object-fit: cover;">
                                        </div>
                                        ${post.media.length > 1 ? 
                                            `<div style="position: absolute; bottom: 1rem; right: 1rem; background: rgba(0,0,0,0.7); color: white; padding: 0.25rem 0.75rem; border-radius: var(--radius-full); font-size: 0.875rem;">
                                                <i class="fas fa-images"></i> ${post.media.length} photos
                                            </div>` : ''
                                        }
                                    </div>` :
                                    `<div style="width: 100%; height: 300px; background: linear-gradient(135deg, var(--primary), var(--secondary)); 
                                         border-radius: var(--radius); margin-bottom: 1.5rem; display: flex; align-items: center; justify-content: center; color: var(--dark); font-size: 4rem;">
                                        <i class="fas fa-box"></i>
                                    </div>`
                                }
                                
                                <div style="font-size: 2rem; font-weight: 800; color: var(--secondary); margin-bottom: 1.5rem;">
                                    ${formatPrice(post.price)}
                                </div>
                                
                                <div style="margin-bottom: 1.5rem;">
                                    <h4 style="color: var(--white);">Description</h4>
                                    <p style="white-space: pre-line; color: var(--light-gray);">${post.description}</p>
                                </div>
                                
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
                                    <div>
                                        <h5 style="color: var(--white);">Category</h5>
                                        <p style="color: var(--light-gray);">${post.category}</p>
                                    </div>
                                    <div>
                                        <h5 style="color: var(--white);">Location</h5>
                                        <p style="color: var(--light-gray);">${post.location}</p>
                                    </div>
                                    <div>
                                        <h5 style="color: var(--white);">Seller</h5>
                                        <p style="color: var(--light-gray);">${user ? user.name : 'User'}</p>
                                    </div>
                                </div>
                                
                                ${post.boosted ? '<div class="badge badge-secondary" style="margin-bottom: 1.5rem;"><i class="fas fa-rocket"></i> BOOSTED POST</div>' : ''}
                                
                                <div style="color: var(--light-gray); font-size: 0.875rem; margin-bottom: 1.5rem;">
                                    <i class="far fa-eye"></i> ${post.views || 0} views
                                    <span style="margin-left: 1rem;"><i class="fas fa-share"></i> ${AppState.shareAnalytics.filter(s => s.postId === post.id).length} shares</span>
                                </div>
                                
                                <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem;">
                                    ${AppState.currentUser ? `
                                        <button class="btn btn-primary" style="flex: 1;" onclick="contactSeller('${post.id}')">
                                            <i class="fab fa-whatsapp"></i> Contact Seller
                                        </button>
                                    ` : `
                                        <button class="btn btn-primary" style="flex: 1;" onclick="showPage('login')">
                                            <i class="fas fa-sign-in-alt"></i> Login to Contact
                                        </button>
                                    `}
                                    <button class="btn btn-secondary" onclick="sharePost('${post.id}')">
                                        <i class="fas fa-share"></i> Share
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'social':
                    content = `
                        <div class="modal-content">
                            <button class="modal-close" onclick="closeModal('postModal')">&times;</button>
                            <div style="padding: 2rem;">
                                <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1.5rem;">
                                    ${user?.profilePicture ? 
                                        `<img src="${user.profilePicture}" alt="${user.name}" style="width: 50px; height: 50px; border-radius: 50%; object-fit: cover;">` :
                                        `<div class="user-avatar-sm" style="width: 50px; height: 50px; font-size: 1.25rem;">
                                            ${user ? user.name.charAt(0).toUpperCase() : 'U'}
                                        </div>`
                                    }
                                    <div>
                                        <div style="font-weight: 600; color: var(--white);">${user ? user.name : 'User'}</div>
                                        <div style="color: var(--light-gray); font-size: 0.875rem;">
                                            ${formatDate(post.createdAt)}
                                        </div>
                                    </div>
                                </div>
                                
                                <div style="margin-bottom: 1.5rem;">
                                    <p style="white-space: pre-line; color: var(--light-gray);">${post.content}</p>
                                </div>
                                
                                ${post.media && post.media.length > 0 ? `
                                    <div class="media-gallery">
                                        ${post.media.map(media => 
                                            media.startsWith('data:video') ? 
                                            `<div class="media-gallery-item">
                                                <video controls style="width: 100%; height: 100%;">
                                                    <source src="${media}" type="video/mp4">
                                                    Your browser does not support the video tag.
                                                </video>
                                            </div>` :
                                            `<div class="media-gallery-item">
                                                <img src="${media}" alt="Post image" style="width: 100%; height: 100%; object-fit: cover;">
                                            </div>`
                                        ).join('')}
                                    </div>
                                ` : ''}
                                
                                <div class="post-actions">
                                    <button class="post-action" onclick="likePost('${post.id}')">
                                        <i class="far fa-heart"></i> Like (${post.likes || 0})
                                    </button>
                                    <button class="post-action" onclick="sharePost('${post.id}')">
                                        <i class="fas fa-share"></i> Share (${AppState.shareAnalytics.filter(s => s.postId === post.id).length})
                                    </button>
                                </div>
                                
                                ${post.boosted ? '<div class="badge badge-secondary mt-3"><i class="fas fa-rocket"></i> BOOSTED POST</div>' : ''}
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'job':
                    content = `
                        <div class="modal-content">
                            <button class="modal-close" onclick="closeModal('postModal')">&times;</button>
                            <div style="padding: 2rem;">
                                <h3 style="margin-bottom: 1.5rem; color: var(--white);">${post.title}</h3>
                                
                                <div class="badge badge-primary" style="margin-bottom: 1.5rem;">
                                    ${post.jobType.toUpperCase()}
                                </div>
                                
                                <div style="margin-bottom: 1.5rem;">
                                    <h4 style="color: var(--white);">Company</h4>
                                    <p style="color: var(--light-gray);">${post.company}</p>
                                </div>
                                
                                ${post.media && post.media.length > 0 ? `
                                    <div style="margin-bottom: 1.5rem;">
                                        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 1rem;">
                                            ${post.media.slice(0, 3).map(media => 
                                                `<img src="${media}" alt="Company" style="width: 100%; height: 100px; object-fit: cover; border-radius: var(--radius);">`
                                            ).join('')}
                                        </div>
                                    </div>
                                ` : ''}
                                
                                <div style="margin-bottom: 1.5rem;">
                                    <h4 style="color: var(--white);">Job Description</h4>
                                    <p style="white-space: pre-line; color: var(--light-gray);">${post.description}</p>
                                </div>
                                
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
                                    <div>
                                        <h5 style="color: var(--white);">Salary Range</h5>
                                        <p style="color: var(--light-gray);">${formatPrice(post.salaryMin)} - ${formatPrice(post.salaryMax)}</p>
                                    </div>
                                    <div>
                                        <h5 style="color: var(--white);">Location</h5>
                                        <p style="color: var(--light-gray);">${post.location}</p>
                                    </div>
                                    <div>
                                        <h5 style="color: var(--white);">Contact</h5>
                                        <p style="color: var(--light-gray);">${post.whatsapp}</p>
                                    </div>
                                </div>
                                
                                <div style="margin-bottom: 2rem;">
                                    <h5 style="color: var(--white);">How to Apply</h5>
                                    <p style="color: var(--light-gray);">${post.apply}</p>
                                </div>
                                
                                ${post.boosted ? '<div class="badge badge-secondary" style="margin-bottom: 1.5rem;"><i class="fas fa-rocket"></i> BOOSTED POST</div>' : ''}
                                
                                <div style="color: var(--light-gray); font-size: 0.875rem; margin-bottom: 1.5rem;">
                                    <i class="far fa-eye"></i> ${post.views || 0} views
                                    <span style="margin-left: 1rem;"><i class="fas fa-share"></i> ${AppState.shareAnalytics.filter(s => s.postId === post.id).length} shares</span>
                                </div>
                                
                                <div style="display: flex; gap: 1rem;">
                                    ${AppState.currentUser ? `
                                        <button class="btn btn-primary" style="flex: 1;" onclick="applyForJob('${post.id}')">
                                            <i class="fas fa-paper-plane"></i> Apply Now
                                        </button>
                                        <button class="btn btn-secondary" onclick="sharePost('${post.id}')">
                                            <i class="fas fa-share"></i> Share
                                        </button>
                                    ` : `
                                        <button class="btn btn-primary w-full" onclick="showPage('login')">
                                            <i class="fas fa-sign-in-alt"></i> Login to Apply
                                        </button>
                                    `}
                                </div>
                            </div>
                        </div>
                    `;
                    break;
            }
            
            modal.innerHTML = content;
            modal.classList.add('active');
        }
        
        function contactSeller(postId) {
            const post = AppState.posts.find(p => p.id === postId);
            if (!post || !post.whatsapp) return;
            
            const message = `Hello, I'm interested in your ${post.type === 'product' ? 'product' : post.type} "${post.title || 'post'}" on QUICK SHOP.`;
            const url = `https://wa.me/${post.whatsapp}?text=${encodeURIComponent(message)}`;
            window.open(url, '_blank');
        }
        
        function contactJobPoster(postId) {
            const post = AppState.posts.find(p => p.id === postId);
            if (!post || !post.whatsapp) return;
            
            const message = `Hello, I'm interested in the ${post.title} position at ${post.company} on QUICK SHOP.`;
            const url = `https://wa.me/${post.whatsapp}?text=${encodeURIComponent(message)}`;
            window.open(url, '_blank');
        }
        
        function applyForJob(postId) {
            const post = AppState.posts.find(p => p.id === postId);
            if (!post) return;
            
            if (post.apply.includes('@')) {
                const subject = `Job Application: ${post.title}`;
                const body = `Dear Hiring Manager,\n\nI am interested in applying for the ${post.title} position at ${post.company}.\n\n[Your application details here]`;
                window.open(`mailto:${post.apply}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`);
            } else if (post.apply.includes('http')) {
                window.open(post.apply, '_blank');
            } else {
                navigator.clipboard.writeText(post.apply).then(() => {
                    showNotification('Application email copied to clipboard', 'success');
                });
            }
        }
        
        function likePost(postId) {
            const post = AppState.posts.find(p => p.id === postId);
            if (post) {
                post.likes = (post.likes || 0) + 1;
                saveToLocalStorage();
                showNotification('Post liked!', 'success');
                viewPost(postId);
            }
        }
        
        // ============================================
        // AUTHENTICATION
        // ============================================
        
        function loadRegisterForm() {
            const form = document.getElementById('registerForm');
            if (!form) return;
            
            form.innerHTML = `
                <div class="form-group">
                    <label class="form-label">Full Name *</label>
                    <input type="text" class="form-control" id="regName" placeholder="John Doe" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Email Address *</label>
                    <input type="email" class="form-control" id="regEmail" placeholder="you@example.com" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Phone Number *</label>
                    <input type="text" class="form-control" id="regPhone" placeholder="2547XXXXXXXX" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Password *</label>
                    <input type="password" class="form-control" id="regPassword" placeholder="" minlength="6" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Confirm Password *</label>
                    <input type="password" class="form-control" id="regConfirmPassword" placeholder="" minlength="6" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Referral Code (Optional)</label>
                    <input type="text" class="form-control" id="regReferral" placeholder="Enter if referred">
                </div>
                
                <button type="submit" class="btn btn-primary w-full">
                    <i class="fas fa-user-plus"></i> Create Account
                </button>
                
                <div class="text-center mt-3">
                    <p style="color: var(--light-gray);">
                        Already have an account? 
                        <a href="#" onclick="return showPage('login')" style="color: var(--primary-light); font-weight: 600;">Login here</a>
                    </p>
                </div>
            `;
            
            form.onsubmit = function(e) {
                e.preventDefault();
                registerUser();
            };
        }
        
        function registerUser() {
            const name = document.getElementById('regName').value;
            const email = document.getElementById('regEmail').value;
            const phone = document.getElementById('regPhone').value;
            const password = document.getElementById('regPassword').value;
            const confirmPassword = document.getElementById('regConfirmPassword').value;
            const referralCode = document.getElementById('regReferral').value;
            
            if (!validateEmail(email)) {
                showNotification('Invalid email address', 'error');
                return;
            }
            
            if (!validatePhone(phone)) {
                showNotification('Invalid phone number (use format: 2547XXXXXXXX)', 'error');
                return;
            }
            
            if (password.length < 6) {
                showNotification('Password must be at least 6 characters', 'error');
                return;
            }
            
            if (password !== confirmPassword) {
                showNotification('Passwords do not match', 'error');
                return;
            }
            
            if (AppState.users.some(u => u.email === email && !u.hidden)) {
                showNotification('Email already registered', 'error');
                return;
            }
            
            let referrer = null;
            if (referralCode) {
                referrer = AppState.users.find(u => u.referralCode === referralCode && !u.hidden);
                if (!referrer) {
                    showNotification('Invalid referral code', 'error');
                    return;
                }
                
                trackReferralAnalyticsForUser(referrer.id, 'signup');
            }
            
            const user = {
                id: generateId(),
                name: name,
                email: email,
                phone: phone,
                password: btoa(password),
                referralCode: generateReferralCode(name),
                subscription: { active: false },
                role: 'user',
                createdAt: new Date().toISOString(),
                profilePicture: null,
                location: '',
                bio: '',
                verified: false,
                earnings: { balance: 0, totalEarned: 0, totalWithdrawn: 0 }
            };
            
            AppState.users.push(user);
            
            if (referrer) {
                const referral = {
                    id: generateId(),
                    referrerId: referrer.id,
                    referredUserId: user.id,
                    commission: AppState.settings.subscriptionPrice * AppState.settings.referralCommission,
                    status: 'pending',
                    createdAt: new Date().toISOString()
                };
                AppState.referrals.push(referral);
            }
            
            saveToLocalStorage();
            
            AppState.currentUser = user;
            localStorage.setItem('qs_currentUser', JSON.stringify({ id: user.id }));
            
            showNotification(`Welcome to QUICK SHOP, ${name}!`, 'success');
            showPage('subscribe');
        }
        
        function trackReferralAnalyticsForUser(referrerId, type) {
            const analytics = {
                id: generateId(),
                referrerId: referrerId,
                type: type,
                timestamp: new Date().toISOString()
            };
            
            AppState.referralAnalytics.push(analytics);
            saveToLocalStorage();
        }
        
        function loadLoginForm() {
            const form = document.getElementById('loginForm');
            if (!form) return;
            
            form.innerHTML = `
                <div class="form-group">
                    <label class="form-label">Email Address</label>
                    <input type="email" class="form-control" id="loginEmail" placeholder="you@example.com" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input type="password" class="form-control" id="loginPassword" placeholder="" required>
                </div>
                
                <div class="form-group">
                    <label style="font-weight: normal; color: var(--light-gray);">
                        <input type="checkbox" id="rememberMe" style="margin-right: 0.5rem;">
                        Remember me
                    </label>
                </div>
                
                <button type="submit" class="btn btn-primary w-full">
                    <i class="fas fa-sign-in-alt"></i> Login
                </button>
                
                <div class="text-center mt-3">
                    <p style="color: var(--light-gray);">
                        <a href="#" onclick="return showPage('forgot-password')" style="color: var(--primary-light); font-weight: 600;">Forgot Password?</a>
                    </p>
                    <p style="color: var(--light-gray); margin-top: 0.5rem;">
                        Don't have an account? 
                        <a href="#" onclick="return showPage('register')" style="color: var(--primary-light); font-weight: 600;">Register here</a>
                    </p>
                </div>
            `;
            
            form.onsubmit = function(e) {
                e.preventDefault();
                loginUser();
            };
        }
        
        function loginUser() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            const user = AppState.users.find(u => 
                u.email === email && 
                atob(u.password) === password && 
                !u.hidden
            );
            
            if (user) {
                AppState.currentUser = user;
                localStorage.setItem('qs_currentUser', JSON.stringify({ id: user.id }));
                
                showNotification(`Welcome back, ${user.name}!`, 'success');
                showPage('home');
            } else {
                showNotification('Invalid email or password', 'error');
            }
        }
        
        function loadForgotPasswordForm() {
            const form = document.getElementById('forgotPasswordForm');
            if (!form) return;
            
            form.innerHTML = `
                <div class="recovery-steps">
                    <div class="step">
                        <div class="step-number">1</div>
                        <div>
                            <strong>Contact Admin on WhatsApp</strong>
                            <p style="color: var(--light-gray); font-size: 0.875rem; margin-top: 0.25rem;">
                                Send a message to admin for password reset
                            </p>
                        </div>
                    </div>
                    
                    <div class="step">
                        <div class="step-number">2</div>
                        <div>
                            <strong>Provide Your Email</strong>
                            <p style="color: var(--light-gray); font-size: 0.875rem; margin-top: 0.25rem;">
                                Tell admin your registered email address
                            </p>
                        </div>
                    </div>
                    
                    <div class="step">
                        <div class="step-number">3</div>
                        <div>
                            <strong>Receive New Password</strong>
                            <p style="color: var(--light-gray); font-size: 0.875rem; margin-top: 0.25rem;">
                                Admin will reset your password and send new details
                            </p>
                        </div>
                    </div>
                </div>
                
                <div style="text-align: center; margin: 2rem 0;">
                    <a href="https://wa.me/${AppState.settings.supportWhatsApp}?text=Hello%20Admin,%20I%20need%20to%20reset%20my%20QUICK%20SHOP%20password.%20My%20email%20is:%20[YOUR_EMAIL]" 
                       target="_blank" class="btn btn-success w-full" style="background: #25D366; border-color: #25D366;">
                        <i class="fab fa-whatsapp"></i> Contact Admin on WhatsApp
                    </a>
                </div>
                
                <div class="text-center mt-3">
                    <p style="color: var(--light-gray);">
                        Remember your password? 
                        <a href="#" onclick="return showPage('login')" style="color: var(--primary-light); font-weight: 600;">Login here</a>
                    </p>
                </div>
            `;
        }
        
        function logout() {
            AppState.currentUser = null;
            localStorage.removeItem('qs_currentUser');
            showNotification('Logged out successfully', 'success');
            showPage('home');
        }
        
        // ============================================
        // SUBSCRIPTION
        // ============================================
        
        function loadSubscriptionForm() {
            if (!AppState.currentUser) {
                showNotification('Please login first', 'error');
                showPage('login');
                return;
            }
            
            const form = document.getElementById('subscriptionForm');
            if (!form) return;
            
            form.innerHTML = `
                <div style="text-align: center; margin-bottom: 2rem;">
                    <div style="width: 100px; height: 100px; background: linear-gradient(135deg, var(--primary), var(--primary-dark)); 
                         border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem; border: 3px solid var(--secondary);">
                        <i class="fas fa-crown" style="font-size: 3rem; color: var(--secondary);"></i>
                    </div>
                    <h3>Weekly Subscription</h3>
                    <div style="font-size: 2.5rem; font-weight: 800; color: var(--secondary); margin: 1rem 0;">
                        KES 50
                    </div>
                    <p style="color: var(--light-gray);">Unlock unlimited posting</p>
                </div>
                
                <div style="background: var(--dark); padding: 1.5rem; border-radius: var(--radius); margin-bottom: 2rem;">
                    <h4 style="margin-bottom: 1rem; color: var(--white);">Subscription Benefits:</h4>
                    <ul style="padding-left: 1.5rem; color: var(--light-gray);">
                        <li>Post unlimited products, jobs, and social updates</li>
                        <li>Upload images and videos with posts</li>
                        <li>Access to marketplace features</li>
                        <li>Earn through referral program</li>
                        <li>Boost posts for increased visibility</li>
                        <li>7 days access per subscription</li>
                        <li><strong>Admin approval required after payment</strong></li>
                    </ul>
                </div>
                
                <div class="payment-steps">
                    <div style="display: flex; align-items: flex-start; gap: 1rem; margin-bottom: 1.5rem;">
                        <div style="width: 30px; height: 30px; background: var(--primary); color: var(--secondary); 
                             border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600;">
                            1
                        </div>
                        <div>
                            <strong>Pay KES 50 via M-Pesa</strong>
                            <p style="color: var(--light-gray); font-size: 0.875rem; margin-top: 0.25rem;">
                                <strong>Paybill:</strong> ${AppState.settings.mpesaPaybill}<br>
                                <strong>Account:</strong> ${AppState.settings.mpesaAccount}<br>
                                <strong>Amount:</strong> KES 50
                            </p>
                        </div>
                    </div>
                    
                    <div style="display: flex; align-items: flex-start; gap: 1rem; margin-bottom: 1.5rem;">
                        <div style="width: 30px; height: 30px; background: var(--primary); color: var(--secondary); 
                             border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600;">
                            2
                        </div>
                        <div>
                            <strong>Enter Transaction Code</strong>
                            <p style="color: var(--light-gray); font-size: 0.875rem; margin-top: 0.25rem;">
                                Enter M-Pesa confirmation code (e.g., ABC1234DEF)
                            </p>
                        </div>
                    </div>
                    
                    <div style="display: flex; align-items: flex-start; gap: 1rem; margin-bottom: 1.5rem;">
                        <div style="width: 30px; height: 30px; background: var(--primary); color: var(--secondary); 
                             border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600;">
                            3
                        </div>
                        <div>
                            <strong>Admin Approval</strong>
                            <p style="color: var(--light-gray); font-size: 0.875rem; margin-top: 0.25rem;">
                                Admin will approve within 24 hours
                            </p>
                        </div>
                    </div>
                </div>
                
                <form onsubmit="processSubscription(); return false;">
                    <div class="form-group">
                        <input type="text" class="form-control" id="subscriptionTransactionCode" 
                               placeholder="Enter M-Pesa Transaction Code" required>
                    </div>
                    <button type="submit" class="btn btn-primary w-full">
                        <i class="fas fa-paper-plane"></i> Submit for Approval
                    </button>
                </form>
                
                <div class="text-center mt-3">
                    <p style="color: var(--light-gray);">
                        Need help? WhatsApp: ${AppState.settings.supportWhatsApp}
                    </p>
                </div>
            `;
        }
        
        function processSubscription() {
            const transactionCode = document.getElementById('subscriptionTransactionCode').value;
            if (!transactionCode) {
                showNotification('Please enter transaction code', 'error');
                return;
            }
            
            if (transactionCode.length < 8) {
                showNotification('Please enter a valid M-Pesa transaction code', 'error');
                return;
            }
            
            const payment = {
                id: generateId(),
                userId: AppState.currentUser.id,
                amount: AppState.settings.subscriptionPrice,
                type: 'subscription',
                transactionCode: transactionCode,
                status: 'pending',
                createdAt: new Date().toISOString()
            };
            
            AppState.payments.push(payment);
            saveToLocalStorage();
            
            showNotification('Subscription request submitted! Admin will approve within 24 hours.', 'success');
            showPage('dashboard');
        }
        
        // ============================================
        // ADMIN PANEL
        // ============================================
        
        function loadAdminPanel() {
            if (!AppState.currentUser || AppState.currentUser.role !== 'admin') {
                showNotification('Admin access required', 'error');
                showPage('home');
                return;
            }
            
            updateAdminStats();
            showAdminTab('pending');
        }
        
        function updateAdminStats() {
            const visibleUsers = AppState.users.filter(u => !u.hidden && u.role !== 'admin');
            const totalPosts = AppState.posts.length;
            const pendingApprovals = AppState.payments.filter(p => p.status === 'pending').length;
            const totalRevenue = AppState.payments
                .filter(p => p.status === 'approved')
                .reduce((sum, p) => sum + p.amount, 0);
            
            document.getElementById('adminUsers').textContent = visibleUsers.length;
            document.getElementById('adminPosts').textContent = totalPosts;
            document.getElementById('adminPending').textContent = pendingApprovals;
            document.getElementById('adminRevenue').textContent = formatPrice(totalRevenue);
        }
        
        function showAdminTab(tabName) {
            document.querySelectorAll('#admin .tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.querySelectorAll('#admin .tab-btn').forEach(btn => {
                if (btn.textContent.toLowerCase().includes(tabName)) {
                    btn.classList.add('active');
                }
            });
            
            const container = document.getElementById('adminContent');
            let content = '';
            
            switch(tabName) {
                case 'pending':
                    content = renderPendingApprovals();
                    break;
                case 'withdrawals':
                    content = renderPendingWithdrawals();
                    break;
                case 'users':
                    content = renderAllUsers();
                    break;
                case 'posts':
                    content = renderAllPosts();
                    break;
                case 'referrals':
                    content = renderReferralAnalytics();
                    break;
                case 'settings':
                    content = renderAdminSettings();
                    break;
            }
            
            container.innerHTML = content;
        }
        
        function renderPendingApprovals() {
            const pendingPayments = AppState.payments.filter(p => p.status === 'pending');
            
            if (pendingPayments.length === 0) {
                return `
                    <div class="empty-state">
                        <i class="fas fa-check-circle"></i>
                        <h3 style="color: var(--white);">No pending approvals</h3>
                        <p>All payments have been processed</p>
                    </div>
                `;
            }
            
            let html = `
                <div style="background: var(--dark-gray); border-radius: var(--radius-lg); overflow: hidden; border: 1px solid var(--primary);">
                    <div style="overflow-x: auto;">
                        <table class="admin-table">
                            <thead>
                                <tr>
                                    <th>User</th>
                                    <th>Type</th>
                                    <th>Amount</th>
                                    <th>Transaction Code</th>
                                    <th>Date</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
            `;
            
            pendingPayments.forEach(payment => {
                const user = AppState.users.find(u => u.id === payment.userId);
                html += `
                    <tr>
                        <td>${user ? user.name : 'Unknown'}</td>
                        <td>${payment.type === 'subscription' ? 'Subscription' : 'Boost'}</td>
                        <td>${formatPrice(payment.amount)}</td>
                        <td><code>${payment.transactionCode}</code></td>
                        <td>${formatDate(payment.createdAt)}</td>
                        <td class="admin-actions">
                            <button class="btn btn-sm btn-primary" onclick="approvePayment('${payment.id}')">
                                <i class="fas fa-check"></i> Approve
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="rejectPayment('${payment.id}')">
                                <i class="fas fa-times"></i> Reject
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            html += `</tbody></table></div></div>`;
            return html;
        }
        
        function approvePayment(paymentId) {
            const payment = AppState.payments.find(p => p.id === paymentId);
            if (!payment) return;
            
            payment.status = 'approved';
            payment.approvedAt = new Date().toISOString();
            payment.approvedBy = AppState.currentUser.name;
            
            if (payment.type === 'subscription') {
                const user = AppState.users.find(u => u.id === payment.userId);
                if (user) {
                    user.subscription = {
                        active: true,
                        expiresAt: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString(),
                        lastPayment: new Date().toISOString()
                    };
                }
                
                const referral = AppState.referrals.find(r => 
                    r.referredUserId === payment.userId && 
                    r.status === 'pending'
                );
                
                if (referral) {
                    referral.status = 'approved';
                    referral.completedAt = new Date().toISOString();
                    
                    const referrer = AppState.users.find(u => u.id === referral.referrerId);
                    if (referrer) {
                        referrer.earnings.balance += referral.commission;
                        referrer.earnings.totalEarned += referral.commission;
                    }
                }
            } else if (payment.type === 'boost') {
                const boost = AppState.boosts.find(b => b.transactionCode === payment.transactionCode);
                if (boost) {
                    boost.status = 'approved';
                    const post = AppState.posts.find(p => p.id === boost.postId);
                    if (post) post.boosted = true;
                }
            }
            
            saveToLocalStorage();
            showAdminTab('pending');
            showNotification('Payment approved successfully', 'success');
        }
        
        function rejectPayment(paymentId) {
            const payment = AppState.payments.find(p => p.id === paymentId);
            if (!payment) return;
            
            payment.status = 'rejected';
            payment.rejectedAt = new Date().toISOString();
            payment.rejectedBy = AppState.currentUser.name;
            
            saveToLocalStorage();
            showAdminTab('pending');
            showNotification('Payment rejected', 'info');
        }
        
        function renderPendingWithdrawals() {
            const pendingWithdrawals = AppState.withdrawals.filter(w => w.status === 'pending');
            
            if (pendingWithdrawals.length === 0) {
                return `
                    <div class="empty-state">
                        <i class="fas fa-check-circle"></i>
                        <h3 style="color: var(--white);">No pending withdrawals</h3>
                        <p>All withdrawal requests have been processed</p>
                    </div>
                `;
            }
            
            let html = `
                <div style="background: var(--dark-gray); border-radius: var(--radius-lg); overflow: hidden; border: 1px solid var(--primary);">
                    <div style="overflow-x: auto;">
                        <table class="admin-table">
                            <thead>
                                <tr>
                                    <th>User</th>
                                    <th>Amount</th>
                                    <th>M-Pesa Number</th>
                                    <th>Date</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
            `;
            
            pendingWithdrawals.forEach(withdrawal => {
                const user = AppState.users.find(u => u.id === withdrawal.userId);
                html += `
                    <tr>
                        <td>${user ? user.name : 'Unknown'}</td>
                        <td>${formatPrice(withdrawal.amount)}</td>
                        <td>${withdrawal.mpesaNumber}</td>
                        <td>${formatDate(withdrawal.createdAt)}</td>
                        <td class="admin-actions">
                            <button class="btn btn-sm btn-primary" onclick="approveWithdrawal('${withdrawal.id}')">
                                <i class="fas fa-check"></i> Approve
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="rejectWithdrawal('${withdrawal.id}')">
                                <i class="fas fa-times"></i> Reject
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            html += `</tbody></table></div></div>`;
            return html;
        }
        
        function approveWithdrawal(withdrawalId) {
            const withdrawal = AppState.withdrawals.find(w => w.id === withdrawalId);
            if (!withdrawal) return;
            
            const user = AppState.users.find(u => u.id === withdrawal.userId);
            if (!user) return;
            
            withdrawal.status = 'approved';
            withdrawal.approvedAt = new Date().toISOString();
            withdrawal.approvedBy = AppState.currentUser.name;
            
            user.earnings.balance -= withdrawal.amount;
            user.earnings.totalWithdrawn += withdrawal.amount;
            
            saveToLocalStorage();
            showAdminTab('withdrawals');
            showNotification(`KES ${withdrawal.amount} sent to ${withdrawal.mpesaNumber}`, 'success');
        }
        
        function rejectWithdrawal(withdrawalId) {
            const withdrawal = AppState.withdrawals.find(w => w.id === withdrawalId);
            if (!withdrawal) return;
            
            withdrawal.status = 'rejected';
            withdrawal.rejectedAt = new Date().toISOString();
            withdrawal.rejectedBy = AppState.currentUser.name;
            
            saveToLocalStorage();
            showAdminTab('withdrawals');
            showNotification('Withdrawal rejected', 'info');
        }
        
        function renderAllUsers() {
            const visibleUsers = AppState.users.filter(u => !u.hidden);
            
            let html = `
                <div style="background: var(--dark-gray); border-radius: var(--radius-lg); overflow: hidden; border: 1px solid var(--primary);">
                    <div style="overflow-x: auto;">
                        <table class="admin-table">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Phone</th>
                                    <th>Subscription</th>
                                    <th>Referrals</th>
                                    <th>Earnings</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
            `;
            
            visibleUsers.forEach(user => {
                const referrals = AppState.referrals.filter(r => r.referrerId === user.id && r.status === 'approved');
                const earnings = referrals.reduce((sum, r) => sum + r.commission, 0);
                const postsCount = AppState.posts.filter(p => p.userId === user.id).length;
                
                html += `
                    <tr>
                        <td>
                            ${user.name} ${user.role === 'admin' ? '<span class="badge badge-primary">Admin</span>' : ''}
                        </td>
                        <td>${user.email}</td>
                        <td>${user.phone}</td>
                        <td>
                            ${user.subscription?.active ? 
                                `<span class="badge badge-success">Active</span><br><small>${user.subscription.expiresAt ? formatDate(user.subscription.expiresAt) : ''}</small>` : 
                                '<span class="badge badge-danger">Inactive</span>'
                            }
                        </td>
                        <td>
                            ${referrals.length} referrals<br>
                            <small>${postsCount} posts</small>
                        </td>
                        <td>${formatPrice(earnings)}</td>
                        <td class="admin-actions">
                            <button class="btn btn-sm btn-outline" onclick="viewUserDetails('${user.id}')">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-sm btn-primary" onclick="editUserAccount('${user.id}')">
                                <i class="fas fa-edit"></i>
                            </button>
                            ${user.role !== 'admin' ? `
                                <button class="btn btn-sm btn-danger" onclick="deleteUser('${user.id}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            ` : ''}
                        </td>
                    </tr>
                `;
            });
            
            html += `</tbody></table></div></div>`;
            return html;
        }
        
        function editUserAccount(userId) {
            const user = AppState.users.find(u => u.id === userId);
            if (!user) return;
            
            const modal = document.getElementById('paymentModal');
            modal.innerHTML = `
                <div class="modal-content">
                    <button class="modal-close" onclick="closeModal('paymentModal')">&times;</button>
                    <div style="padding: 2rem;">
                        <h3 style="margin-bottom: 1.5rem; color: var(--white);">Edit User Account</h3>
                        
                        <form onsubmit="saveUserEdits('${userId}'); return false;">
                            <div class="form-group">
                                <label class="form-label">Full Name</label>
                                <input type="text" class="form-control" id="editUserName" value="${user.name}" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Email Address</label>
                                <input type="email" class="form-control" id="editUserEmail" value="${user.email}" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Phone Number</label>
                                <input type="text" class="form-control" id="editUserPhone" value="${user.phone}" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Subscription Status</label>
                                <select class="form-control" id="editUserSubscription">
                                    <option value="active" ${user.subscription?.active ? 'selected' : ''}>Active</option>
                                    <option value="inactive" ${!user.subscription?.active ? 'selected' : ''}>Inactive</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Reset Password</label>
                                <input type="password" class="form-control" id="editUserPassword" placeholder="New password (optional)">
                                <small style="color: var(--light-gray);">Leave blank to keep current password</small>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Balance Adjustment</label>
                                <input type="number" class="form-control" id="editUserBalance" value="${user.earnings?.balance || 0}">
                                <small style="color: var(--light-gray);">Adjust user's referral earnings balance</small>
                            </div>
                            
                            <div style="display: flex; gap: 1rem; margin-top: 2rem;">
                                <button type="submit" class="btn btn-primary" style="flex: 1;">
                                    <i class="fas fa-save"></i> Save Changes
                                </button>
                                <button type="button" class="btn btn-secondary" onclick="resetUserPassword('${userId}')">
                                    <i class="fas fa-key"></i> Reset Password
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            `;
            
            modal.classList.add('active');
        }
        
        function saveUserEdits(userId) {
            const user = AppState.users.find(u => u.id === userId);
            if (!user) return;
            
            const name = document.getElementById('editUserName').value;
            const email = document.getElementById('editUserEmail').value;
            const phone = document.getElementById('editUserPhone').value;
            const subscription = document.getElementById('editUserSubscription').value;
            const newPassword = document.getElementById('editUserPassword').value;
            const balance = parseFloat(document.getElementById('editUserBalance').value) || 0;
            
            if (!validateEmail(email)) {
                showNotification('Invalid email address', 'error');
                return;
            }
            
            if (!validatePhone(phone)) {
                showNotification('Invalid phone number', 'error');
                return;
            }
            
            const emailExists = AppState.users.some(u => 
                u.email === email && u.id !== userId && !u.hidden
            );
            
            if (emailExists) {
                showNotification('Email already taken by another user', 'error');
                return;
            }
            
            user.name = name;
            user.email = email;
            user.phone = phone;
            
            if (subscription === 'active') {
                if (!user.subscription?.active) {
                    user.subscription = {
                        active: true,
                        expiresAt: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString()
                    };
                }
            } else {
                user.subscription = { active: false };
            }
            
            if (newPassword) {
                if (newPassword.length < 6) {
                    showNotification('Password must be at least 6 characters', 'error');
                    return;
                }
                user.password = btoa(newPassword);
            }
            
            user.earnings = user.earnings || { balance: 0, totalEarned: 0, totalWithdrawn: 0 };
            user.earnings.balance = balance;
            
            saveToLocalStorage();
            closeModal('paymentModal');
            showAdminTab('users');
            showNotification('User account updated successfully', 'success');
        }
        
        function resetUserPassword(userId) {
            const user = AppState.users.find(u => u.id === userId);
            if (!user) return;
            
            const newPassword = Math.random().toString(36).slice(-8);
            user.password = btoa(newPassword);
            
            saveToLocalStorage();
            showNotification(`Password reset to: ${newPassword}. Please inform the user.`, 'success');
        }
        
        function viewUserDetails(userId) {
            const user = AppState.users.find(u => u.id === userId);
            if (!user) return;
            
            const userPosts = AppState.posts.filter(p => p.userId === userId);
            const referrals = AppState.referrals.filter(r => r.referrerId === userId);
            const earnings = referrals.filter(r => r.status === 'approved').reduce((sum, r) => sum + r.commission, 0);
            const referralAnalytics = AppState.referralAnalytics.filter(a => a.referrerId === userId);
            
            const modal = document.getElementById('postModal');
            modal.innerHTML = `
                <div class="modal-content">
                    <button class="modal-close" onclick="closeModal('postModal')">&times;</button>
                    <div style="padding: 2rem;">
                        <div style="text-align: center; margin-bottom: 2rem;">
                            ${user.profilePicture ? 
                                `<img src="${user.profilePicture}" alt="${user.name}" style="width: 100px; height: 100px; border-radius: 50%; object-fit: cover; margin-bottom: 1rem;">` :
                                `<div style="width: 100px; height: 100px; background: linear-gradient(135deg, var(--primary), var(--secondary)); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: var(--dark); font-size: 2rem; font-weight: 600; margin: 0 auto 1rem;">
                                    ${user.name.charAt(0).toUpperCase()}
                                </div>`
                            }
                            <h3>${user.name}</h3>
                            <p style="color: var(--light-gray);">${user.email}</p>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
                            <div style="text-align: center; padding: 1rem; background: var(--dark); border-radius: var(--radius);">
                                <div style="font-size: 1.5rem; font-weight: 800; color: var(--secondary);">${userPosts.length}</div>
                                <div>Posts</div>
                            </div>
                            <div style="text-align: center; padding: 1rem; background: var(--dark); border-radius: var(--radius);">
                                <div style="font-size: 1.5rem; font-weight: 800; color: var(--secondary);">${referrals.length}</div>
                                <div>Referrals</div>
                            </div>
                            <div style="text-align: center; padding: 1rem; background: var(--dark); border-radius: var(--radius);">
                                <div style="font-size: 1.5rem; font-weight: 800; color: var(--secondary);">${formatPrice(earnings)}</div>
                                <div>Earnings</div>
                            </div>
                            <div style="text-align: center; padding: 1rem; background: var(--dark); border-radius: var(--radius);">
                                <div style="font-size: 1.5rem; font-weight: 800; color: var(--secondary);">${referralAnalytics.length}</div>
                                <div>Referral Views</div>
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 1.5rem;">
                            <h4 style="color: var(--white);">User Information</h4>
                            <p><strong>Phone:</strong> ${user.phone}</p>
                            <p><strong>Location:</strong> ${user.location || 'Not specified'}</p>
                            <p><strong>Member Since:</strong> ${formatDate(user.createdAt)}</p>
                            <p><strong>Subscription:</strong> ${user.subscription?.active ? 'Active' : 'Inactive'}</p>
                            <p><strong>Referral Code:</strong> ${user.referralCode}</p>
                        </div>
                        
                        <div style="margin-bottom: 1.5rem;">
                            <h4 style="color: var(--white);">Bio</h4>
                            <p>${user.bio || 'No bio provided'}</p>
                        </div>
                        
                        <button class="btn btn-primary w-full" onclick="closeModal('postModal')">
                            Close
                        </button>
                    </div>
                </div>
            `;
            modal.classList.add('active');
        }
        
        function deleteUser(userId) {
            if (!confirm('Are you sure you want to delete this user? All their posts will also be deleted.')) return;
            
            AppState.posts = AppState.posts.filter(p => p.userId !== userId);
            AppState.users = AppState.users.filter(u => u.id !== userId);
            
            if (AppState.currentUser && AppState.currentUser.id === userId) {
                logout();
            }
            
            saveToLocalStorage();
            showAdminTab('users');
            showNotification('User deleted successfully', 'success');
        }
        
        function renderAllPosts() {
            let html = `
                <div style="background: var(--dark-gray); border-radius: var(--radius-lg); overflow: hidden; border: 1px solid var(--primary);">
                    <div style="overflow-x: auto;">
                        <table class="admin-table">
                            <thead>
                                <tr>
                                    <th>Type</th>
                                    <th>Title/Content</th>
                                    <th>User</th>
                                    <th>Boosted</th>
                                    <th>Views</th>
                                    <th>Shares</th>
                                    <th>Date</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
            `;
            
            AppState.posts.forEach(post => {
                const user = AppState.users.find(u => u.id === post.userId);
                const title = post.title || (post.content ? post.content.substring(0, 50) + '...' : 'Social Post');
                const shareCount = AppState.shareAnalytics.filter(s => s.postId === post.id).length;
                
                html += `
                    <tr>
                        <td>
                            ${post.type.charAt(0).toUpperCase() + post.type.slice(1)}
                        </td>
                        <td>
                            ${title}
                        </td>
                        <td>
                            ${user ? user.name : 'Unknown'}
                        </td>
                        <td>
                            ${post.boosted ? '<span class="badge badge-secondary">Yes</span>' : 'No'}
                        </td>
                        <td>
                            ${post.views || 0}
                        </td>
                        <td>
                            ${shareCount}
                        </td>
                        <td>
                            ${formatDate(post.createdAt)}
                        </td>
                        <td class="admin-actions">
                            <button class="btn btn-sm btn-outline" onclick="viewPost('${post.id}')">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deletePost('${post.id}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            html += `</tbody></table></div></div>`;
            return html;
        }
        
        function deletePost(postId) {
            if (!confirm('Are you sure you want to delete this post?')) return;
            
            AppState.posts = AppState.posts.filter(p => p.id !== postId);
            saveToLocalStorage();
            showAdminTab('posts');
            showNotification('Post deleted', 'success');
        }
        
        function renderReferralAnalytics() {
            let html = `
                <div style="background: var(--dark-gray); border-radius: var(--radius-lg); padding: 2rem; box-shadow: var(--shadow); border: 1px solid var(--primary);">
                    <h3 style="margin-bottom: 1.5rem; color: var(--white);">Referral Analytics</h3>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
                        <div style="background: var(--dark); padding: 1.5rem; border-radius: var(--radius); text-align: center;">
                            <div style="font-size: 2rem; font-weight: 800; color: var(--secondary);">
                                ${AppState.referralAnalytics.filter(a => a.type === 'view').length}
                            </div>
                            <div style="color: var(--light-gray);">Total Views</div>
                        </div>
                        
                        <div style="background: var(--dark); padding: 1.5rem; border-radius: var(--radius); text-align: center;">
                            <div style="font-size: 2rem; font-weight: 800; color: var(--secondary);">
                                ${AppState.referralAnalytics.filter(a => a.type === 'click').length}
                            </div>
                            <div style="color: var(--light-gray);">Total Clicks</div>
                        </div>
                        
                        <div style="background: var(--dark); padding: 1.5rem; border-radius: var(--radius); text-align: center;">
                            <div style="font-size: 2rem; font-weight: 800; color: var(--secondary);">
                                ${AppState.referralAnalytics.filter(a => a.type === 'signup').length}
                            </div>
                            <div style="color: var(--light-gray);">Total Signups</div>
                        </div>
                        
                        <div style="background: var(--dark); padding: 1.5rem; border-radius: var(--radius); text-align: center;">
                            <div style="font-size: 2rem; font-weight: 800; color: var(--secondary);">
                                ${AppState.referrals.filter(r => r.status === 'approved').length}
                            </div>
                            <div style="color: var(--light-gray);">Approved Referrals</div>
                        </div>
                    </div>
                    
                    <div style="overflow-x: auto;">
                        <table class="admin-table">
                            <thead>
                                <tr>
                                    <th>User</th>
                                    <th>Views</th>
                                    <th>Clicks</th>
                                    <th>Signups</th>
                                    <th>Approved</th>
                                    <th>Earnings</th>
                                </tr>
                            </thead>
                            <tbody>
            `;
            
            const users = AppState.users.filter(u => !u.hidden && u.role !== 'admin');
            users.forEach(user => {
                const userAnalytics = AppState.referralAnalytics.filter(a => a.referrerId === user.id);
                const views = userAnalytics.filter(a => a.type === 'view').length;
                const clicks = userAnalytics.filter(a => a.type === 'click').length;
                const signups = userAnalytics.filter(a => a.type === 'signup').length;
                const approvedReferrals = AppState.referrals.filter(r => r.referrerId === user.id && r.status === 'approved').length;
                const earnings = AppState.referrals.filter(r => r.referrerId === user.id && r.status === 'approved')
                    .reduce((sum, r) => sum + r.commission, 0);
                
                html += `
                    <tr>
                        <td>${user.name}</td>
                        <td>${views}</td>
                        <td>${clicks}</td>
                        <td>${signups}</td>
                        <td>${approvedReferrals}</td>
                        <td>${formatPrice(earnings)}</td>
                    </tr>
                `;
            });
            
            html += `</tbody></table></div></div>`;
            return html;
        }
        
        function renderAdminSettings() {
            return `
                <div style="background: var(--dark-gray); border-radius: var(--radius-lg); padding: 2rem; box-shadow: var(--shadow); border: 1px solid var(--primary);">
                    <h3 style="margin-bottom: 1.5rem; color: var(--white);">System Settings</h3>
                    
                    <form onsubmit="updateAdminSettings(); return false;">
                        <div class="form-group">
                            <label class="form-label">Subscription Price (KES)</label>
                            <input type="number" class="form-control" id="settingSubscriptionPrice" 
                                   value="${AppState.settings.subscriptionPrice}" min="1" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Boost Price (KES)</label>
                            <input type="number" class="form-control" id="settingBoostPrice" 
                                   value="${AppState.settings.boostPrice}" min="1" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Referral Commission (%)</label>
                            <input type="number" class="form-control" id="settingReferralCommission" 
                                   value="${AppState.settings.referralCommission * 100}" min="1" max="100" step="1" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">M-Pesa Paybill</label>
                            <input type="text" class="form-control" id="settingMpesaPaybill" 
                                   value="${AppState.settings.mpesaPaybill}" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">M-Pesa Account</label>
                            <input type="text" class="form-control" id="settingMpesaAccount" 
                                   value="${AppState.settings.mpesaAccount}" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Support WhatsApp</label>
                            <input type="text" class="form-control" id="settingSupportWhatsApp" 
                                   value="${AppState.settings.supportWhatsApp}" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Website URL</label>
                            <input type="url" class="form-control" id="settingWebsiteUrl" 
                                   value="${AppState.settings.websiteUrl}" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Auto Approve Subscriptions</label>
                            <select class="form-control" id="settingAutoApproveSubscription">
                                <option value="false" selected>No (Admin Approval Required)</option>
                                <option value="true">Yes (Automatic Approval)</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Auto Approve Referrals</label>
                            <select class="form-control" id="settingAutoApproveReferrals">
                                <option value="false" selected>No (Admin Approval Required)</option>
                                <option value="true">Yes (Automatic Approval)</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Max File Size (MB)</label>
                            <input type="number" class="form-control" id="settingMaxFileSize" 
                                   value="${AppState.settings.maxFileSize / (1024 * 1024)}" min="1" max="50" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Max Files Per Post</label>
                            <input type="number" class="form-control" id="settingMaxFilesPerPost" 
                                   value="${AppState.settings.maxFilesPerPost}" min="1" max="20" required>
                        </div>
                        
                        <button type="submit" class="btn btn-primary w-full">
                            <i class="fas fa-save"></i> Save Settings
                        </button>
                    </form>
                    
                    <div style="margin-top: 2rem; padding-top: 2rem; border-top: 1px solid var(--gray);">
                        <h4 style="margin-bottom: 1rem; color: var(--white);">System Tools</h4>
                        <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                            <button class="btn btn-outline" onclick="exportData()">
                                <i class="fas fa-download"></i> Export Data
                            </button>
                            <button class="btn btn-outline" onclick="backupData()">
                                <i class="fas fa-database"></i> Backup Data
                            </button>
                            <button class="btn btn-danger" onclick="clearOldData()">
                                <i class="fas fa-trash"></i> Clear Old Data
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function updateAdminSettings() {
            AppState.settings.subscriptionPrice = parseInt(document.getElementById('settingSubscriptionPrice').value);
            AppState.settings.boostPrice = parseInt(document.getElementById('settingBoostPrice').value);
            AppState.settings.referralCommission = parseInt(document.getElementById('settingReferralCommission').value) / 100;
            AppState.settings.mpesaPaybill = document.getElementById('settingMpesaPaybill').value;
            AppState.settings.mpesaAccount = document.getElementById('settingMpesaAccount').value;
            AppState.settings.supportWhatsApp = document.getElementById('settingSupportWhatsApp').value;
            AppState.settings.websiteUrl = document.getElementById('settingWebsiteUrl').value;
            AppState.settings.autoApproveSubscription = document.getElementById('settingAutoApproveSubscription').value === 'true';
            AppState.settings.autoApproveReferrals = document.getElementById('settingAutoApproveReferrals').value === 'true';
            AppState.settings.maxFileSize = parseInt(document.getElementById('settingMaxFileSize').value) * 1024 * 1024;
            AppState.settings.maxFilesPerPost = parseInt(document.getElementById('settingMaxFilesPerPost').value);
            
            saveToLocalStorage();
            showNotification('Settings updated successfully', 'success');
        }
        
        function exportData() {
            const data = {
                users: AppState.users.filter(u => !u.hidden),
                posts: AppState.posts,
                payments: AppState.payments,
                withdrawals: AppState.withdrawals,
                referrals: AppState.referrals,
                boosts: AppState.boosts,
                calculations: AppState.calculations,
                referralAnalytics: AppState.referralAnalytics,
                shareAnalytics: AppState.shareAnalytics,
                settings: AppState.settings,
                exportedAt: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `quickshop-backup-${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showNotification('Data exported successfully', 'success');
        }
        
        function backupData() {
            localStorage.setItem('qs_backup', JSON.stringify(AppState));
            showNotification('Backup created successfully', 'success');
        }
        
        function clearOldData() {
            if (!confirm('Clear posts older than 30 days? This action cannot be undone.')) return;
            
            const thirtyDaysAgo = new Date();
            thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
            
            const oldPosts = AppState.posts.filter(p => new Date(p.createdAt) < thirtyDaysAgo);
            AppState.posts = AppState.posts.filter(p => new Date(p.createdAt) >= thirtyDaysAgo);
            
            saveToLocalStorage();
            showNotification(`Cleared ${oldPosts.length} old posts`, 'success');
            showAdminTab('posts');
        }
        
        // ============================================
        // URL PARAMETERS
        // ============================================
        
        function checkUrlParams() {
            const params = new URLSearchParams(window.location.search);
            const referralCode = params.get('ref');
            const postId = params.get('post');
            
            if (referralCode) {
                trackReferralView(referralCode);
                
                if (!AppState.currentUser) {
                    const input = document.getElementById('regReferral');
                    if (input) input.value = referralCode;
                }
            }
            
            if (postId) {
                const post = AppState.posts.find(p => p.id === postId);
                if (post) {
                    setTimeout(() => viewPost(postId), 1000);
                }
            }
        }
        
        function trackReferralView(referralCode) {
            const referrer = AppState.users.find(u => u.referralCode === referralCode && !u.hidden);
            if (!referrer) return;
            
            const analytics = {
                id: generateId(),
                referrerId: referrer.id,
                type: 'view',
                timestamp: new Date().toISOString()
            };
            
            AppState.referralAnalytics.push(analytics);
            saveToLocalStorage();
        }
        
        // ============================================
        // START APPLICATION
        // ============================================
        
        document.addEventListener('DOMContentLoaded', initApp);
        
        // Make functions globally available
        window.showPage = showPage;
        window.showHomeTab = showHomeTab;
        window.showDashboardTab = showDashboardTab;
        window.showAdminTab = showAdminTab;
        window.showPostForm = showPostForm;
        window.copyReferralLink = copyReferralLink;
        window.shareReferralLink = shareReferralLink;
        window.viewPost = viewPost;
        window.contactSeller = contactSeller;
        window.applyForJob = applyForJob;
        window.likePost = likePost;
        window.sharePost = sharePost;
        window.logout = logout;
        window.closeModal = closeModal;
        window.toggleChatbot = toggleChatbot;
        window.sendChatMessage = sendChatMessage;
        window.sendQuickQuestion = sendQuickQuestion;
    </script>
</body>
</html>